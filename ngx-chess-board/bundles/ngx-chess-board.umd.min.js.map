{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","../../../projects/ngx-chess-board/src/lib/models/pieces/color.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/piece.ts","../../../projects/ngx-chess-board/src/lib/engine/board-state-provider/board-loader/notation-processors/notation-processor-factory.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/point.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/rook.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/king.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/bishop.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/knight.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/pawn.ts","../../../projects/ngx-chess-board/src/lib/models/pieces/queen.ts","../../../projects/ngx-chess-board/src/lib/utils/unicode-constants.ts","../../../projects/ngx-chess-board/src/lib/engine/board-state-provider/board-loader/notation-processors/fen-loader/default-fen-processor.ts","../../../projects/ngx-chess-board/src/lib/models/move-translation.ts","../../../projects/ngx-chess-board/src/lib/utils/move-utils.ts","../../../projects/ngx-chess-board/src/lib/engine/board-state-provider/board-loader/default-pieces-loader.ts","../../../projects/ngx-chess-board/src/lib/engine/board-state-provider/board-loader/notation-processors/pgn-loader/default-pgn-processor.ts","../../../projects/ngx-chess-board/src/lib/engine/drawing-tools/draw-point.ts","../../../projects/ngx-chess-board/src/lib/engine/click/click-utils.ts","../../../projects/ngx-chess-board/src/lib/history-move-provider/history-move.ts","../../../projects/ngx-chess-board/src/lib/history-move-provider/history-move-provider.ts","../../../projects/ngx-chess-board/src/lib/utils/constants.ts","../../../projects/ngx-chess-board/src/lib/utils/inputs/piece-icon-input-manager.ts","../../../projects/ngx-chess-board/src/lib/utils/inputs/piece-type-input.ts","../../../projects/ngx-chess-board/src/lib/engine/coords/coords-provider.ts","../../../projects/ngx-chess-board/src/lib/engine/drag/end/default-drag-end-processor.ts","../../../projects/ngx-chess-board/src/lib/engine/drag/end/drag-end-strategy.ts","../../../projects/ngx-chess-board/src/lib/engine/drag/start/default-drag-start-processor.ts","../../../projects/ngx-chess-board/src/lib/engine/drag/start/drag-start-strategy.ts","../../../projects/ngx-chess-board/src/lib/engine/drawing-tools/colors/default-color-processor.ts","../../../projects/ngx-chess-board/src/lib/engine/drawing-tools/colors/color-strategy.ts","../../../projects/ngx-chess-board/src/lib/engine/drawing-tools/draw-provider.ts","../../../projects/ngx-chess-board/src/lib/engine/abstract-engine-facade.ts","../../../projects/ngx-chess-board/src/lib/engine/board-state-provider/board-loader/board-loader.ts","../../../projects/ngx-chess-board/src/lib/engine/board-state-provider/board-state/board-state.ts","../../../projects/ngx-chess-board/src/lib/engine/board-state-provider/board-state/board-state-provider.ts","../../../projects/ngx-chess-board/src/lib/engine/drawing-tools/shapes/arrow.ts","../../../projects/ngx-chess-board/src/lib/engine/drawing-tools/shapes/circle.ts","../../../projects/ngx-chess-board/src/lib/engine/piece-decorator/available-move-decorator.ts","../../../projects/ngx-chess-board/src/lib/engine/piece-decorator/piece-abstract-decorator.ts","../../../projects/ngx-chess-board/src/lib/piece-promotion/piece-promotion-resolver.ts","../../../projects/ngx-chess-board/src/lib/engine/utils/piece-factory.ts","../../../projects/ngx-chess-board/src/lib/engine/engine-facade.ts","../../../projects/ngx-chess-board/src/lib/models/board.ts","../../../projects/ngx-chess-board/src/lib/service/ngx-chess-board.service.ts","../../../projects/ngx-chess-board/src/lib/ngx-chess-board.component.ts","../../../projects/ngx-chess-board/src/lib/piece-promotion/piece-promotion-modal/piece-promotion-modal.component.ts","../../../projects/ngx-chess-board/src/lib/ngx-chess-board.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","__","this","constructor","create","__values","o","s","Symbol","iterator","m","i","length","next","value","done","TypeError","__read","n","r","e","ar","push","error","__spread","arguments","concat","Color","NotationType","Piece","point","color","constant","relValue","board","checkPoints","Point","row","col","isEqual","that","hasCoordsEqual","clone","Rook","_super","_this","isMovedAlready","getPossibleMoves","possiblePoints","isFieldEmpty","j","getPossibleCaptures","isFieldTakenByEnemy","WHITE","BLACK","getCoveredFields","getPieceByField","King","castledAlready","shortCastled","longCastled","isCastling","isFieldUnderAttack","longCastlePossible","isKingInCheck","pieces","leftRook","shortCastlePossible","rightRook","Bishop","Knight","Pawn","reverted","enPassantPoint","enPassantPiece","Math","abs","Queen","UnicodeConstants","WHITE_KING","name","icon","WHITE_QUEEN","WHITE_KNIGHT","WHITE_ROOK","WHITE_PAWN","WHITE_BISHOP","BLACK_KING","BLACK_QUEEN","BLACK_KNIGHT","BLACK_ROOK","BLACK_PAWN","BLACK_BISHOP","DefaultFenProcessor","process","notation","engineFacade","fen","Error","split","pointer","chunk","charAt","match","Number","pawn","setCurrentPlayer","setCastles","setEnPassant","setFullMoveCount","currentWhitePlayer","castleChunk","includes","setRookAlreadyMoved","rook","find","piece","MoveTranslation","xAxis","yAxis","_xAxis","_yAxis","_reverted","defineProperty","MoveUtils","willMoveCauseCheck","currentColor","destRow","destCol","srcPiece","destPiece","filter","isBound","format","sourcePoint","destPoint","sourceX","destX","String","fromCharCode","translateCoordsToIndex","coords","charCodeAt","findPieceByPossibleMovesContaining","indexes","foundPieces","_c","_d","_e","e_2","_f","console","log","findPieceByPossibleCapturesContaining","e_4","formatSingle","DefaultPiecesLoader","loadDefaultPieces","calculateFEN","DefaultPgnProcessor","reset","moves","extractMoves","counter","move","promotionIndex","replace","this_1","resolvePromotion","substring","test","resolvePieceByFirstChar","indexOf","resolveByCol","resolveByRow","moves_1","moves_1_1","lastIndexOf","trim","movePiece","hasUpperCase","piecesFirstChar","isShortCastle","removePiece","isLongCastle","char","firstPieceFormat","replacePromotion","promotionChar","NotationProcessorFactory","getProcessor","type","FEN","PGN","getDefaultProcessor","DrawPoint","x","y","ClickUtils","getClickPoint","event","top","height","left","width","floor","getDrawingPoint","tileSize","colorStrategy","ctrl","alt","shift","squareSize","xx","yy","resolve","captured","HistoryMoveProvider","historyMovesSubject$","BehaviorSubject","states","addMove","historyMove","historyMoves","pop","lastHistoryMove","getLastMove","state","getAll","clear","getLastMoveIndex","Constants","DEFAULT_DARK_TILE_COLOR","DEFAULT_LIGHT_TILE_COLOR","DEFAULT_SIZE","MIN_BOARD_SIZE","MAX_BOARD_SIZE","PieceTypeInput","ColorInput","PieceIconInputManager","_defaultIcons","_pieceIconInput","isDefaultIcons","undefined","pieceIconInput","getPieceIcon","isWhite","whiteKingUrl","blackKingUrl","whiteQueenUrl","blackQueenUrl","whiteRookUrl","blackRookUrl","whiteBishopUrl","blackBishopUrl","whiteKnightUrl","blackKnightUrl","whitePawnUrl","blackPawnUrl","loadDefaultData","CoordsProvider","defaultXCoords","defaultYCoords","currentXCoords","currentYCoords","reverse","init","DefaultDragEndProcessor","dragEnded","source","element","nativeElement","style","zIndex","pointerEvents","touchAction","DragEndStrategy","dragEndProcessor","setDragEndProcessor","processor","DefaultDragStartProcessor","dragStarted","position","DragStartStrategy","dragStartProcessor","setDragStartProcessor","DefaultColorProcessor","ColorStrategy","colorProcessor","setColorProcessor","DrawProvider","arrowsSubject$","circlesSubject$","arrows$","asObservable","circles$","circles","arrows","addCircle","circle","reomveCircle","removeCircle","addArrow","arrow","removeArrow","containsCircle","checkCircle","some","containsArrow","checkArrow","AbstractEngineFacade","dragStartStrategy","dragEndStrategy","heightAndWidth","freeMode","drawProvider","pieceIconManager","moveHistoryProvider","checkIfPawnFirstMove","checkIfRookMoved","checkIfKingMoved","getMoveHistory","BoardLoader","notationProcessor","addPieces","loadFEN","loadPGN","pgn","setEngineFacade","setNotationProcessor","BoardState","BoardStateProvider","statesSubject$","getStates","lastState","getLastState","isEmpty","getLastStateIndex","Arrow","start","end","Circle","drawPoint","AvailableMoveDecorator","pointClicked","PiecePromotionResolver","resolvePromotionChoice","index","PieceFactory","pieceTypeInput","colorInput","LIGHT","QUEEN","KING","KNIGHT","BISHOP","ROOK","PAWN","EngineFacade","moveChange","_selected","disabling","boardLoader","boardStateProvider","undo","lastBoard","possibleCaptures","possibleMoves","saveMoveClone","moveStateProvider","sourceIndexes","destIndexes","getPieceByPoint","prepareActivePiece","isPointInPossibleMoves","isPointInPossibleCaptures","saveClone","lastMoveSrc","lastMoveDest","disableSelection","pieceClicked","activePiece","onPieceClicked","handleClickEvent","isMouseDown","moving","onFreeMode","onMouseDown","button","ctrlKey","isPieceDisabled","altKey","shiftKey","onMouseUp","drawDisabled","dragDisabled","addDrawPoint","toMovePiece","newPoint","HistoryMove","checkIfPawnTakesEnPassant","checkIfPawnEnpassanted","increaseFullMoveCount","checkForPawnPromote","afterMoveActions","toPromotePiece","openPromoteDialog","blackKingChecked","whiteKingChecked","check","checkmate","checkForPossibleMoves","stalemate","checkForPat","lastMove","emit","assign","modal","open","capture","lightDisabled","darkDisabled","crtl","upPoint","fullMoveCount","addPiece","existing_1","createdPiece","Board","isXYInPossibleMoves","isXYInPossibleCaptures","isXYInSourceMove","isXYInDestMove","isXYInActiveMove","forEach","reversePoint","cloneDeep","enemyColor","field","king","getKingByColor","getCastleFENString","sort","join","toUpperCase","getEnPassantFENString","emptyFields","foundPiece","substr","concatedEnPassant","isXYInPointSelection","isKingChecked","NgxChessBoardService","componentMethodCallSource","Subject","componentMethodCalled$","Injectable","args","providedIn","NgxChessBoardComponent","ngxChessBoardService","darkTileColor","lightTileColor","showCoords","EventEmitter","selected","size","calculatePieceSize","pieceIcons","onRightClick","preventDefault","ngOnChanges","changes","ngOnInit","subscribe","ngAfterViewInit","boardRef","getBoundingClientRect","updateBoard","setFEN","exception","setPGN","getFEN","dragStart","pieceSize","getCustomPieceIcons","JSON","parse","Component","selector","template","Input","Output","ViewChild","HostListener","PiecePromotionModalComponent","opened","closeCallback","onCloseCallback","display","changeSelection","static","NgxChessBoardModule","forRoot","ngModule","providers","NgModule","declarations","imports","CommonModule","DragDropModule","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export enum Color {\r\n    WHITE,\r\n    BLACK,\r\n}\r\n","import { AbstractPiece } from '../../engine/piece-decorator/abstract-piece';\r\nimport { PieceConstant } from '../../utils/unicode-constants';\r\nimport { Board } from '../board';\r\nimport { Color } from './color';\r\nimport { Point } from './point';\r\n\r\nexport abstract class Piece implements AbstractPiece {\r\n    point: Point;\r\n    color: Color;\r\n    constant: PieceConstant;\r\n    checkPoints: Point[] = [];\r\n    relValue: number;\r\n    board: Board;\r\n\r\n    constructor(\r\n        point: Point,\r\n        color: Color,\r\n        constant: PieceConstant,\r\n        relValue: number,\r\n        board: Board\r\n    ) {\r\n        this.color = color;\r\n        this.constant = constant;\r\n        this.point = point;\r\n        this.relValue = relValue;\r\n        this.board = board;\r\n    }\r\n\r\n    abstract getPossibleMoves(): Point[];\r\n\r\n    abstract getPossibleCaptures(): Point[];\r\n\r\n    abstract getCoveredFields(): Point[]; // zwraca liste punktow ktore sa puste lub istnieje na nich pionek tego samego koloru\r\n}\r\n","import { NotationProcessor } from './notation-processor';\nimport {\n    DefaultFenProcessor,\n} from './fen-loader/default-fen-processor';\nimport { DefaultPgnProcessor } from './pgn-loader/default-pgn-processor';\n\nexport class NotationProcessorFactory {\n\n    static getProcessor(type: NotationType): NotationProcessor {\n        switch (type) {\n            case NotationType.FEN:\n                return new DefaultFenProcessor();\n\n            case NotationType.PGN:\n                return new DefaultPgnProcessor();\n\n        }\n    }\n\n    static getDefaultProcessor(): NotationProcessor {\n        return new DefaultFenProcessor();\n    }\n\n}\n\nexport enum NotationType {\n    FEN = 1,\n    PGN = 2\n}\n","export class Point {\n    row: number;\n    col: number;\n\n    constructor(row: number, col: number) {\n        this.row = row;\n        this.col = col;\n    }\n\n    isEqual(that: Point) {\n        return that && this.row === that.row && this.col === that.col;\n    }\n\n    hasCoordsEqual(row: number, col: number) {\n        return row && col && this.row === row && this.col === col;\n    }\n\n    clone() {\n        return new Point(this.row, this.col);\n    }\n}\n","import { PieceConstant } from '../../utils/unicode-constants';\r\nimport { Board } from '../board';\r\nimport { Color } from './color';\r\nimport { King } from './king';\r\nimport { Piece } from './piece';\r\nimport { Point } from './point';\r\n\r\nexport class Rook extends Piece {\r\n    isMovedAlready = false;\r\n\r\n    constructor(\r\n        point: Point,\r\n        color: Color,\r\n        constant: PieceConstant,\r\n        board: Board\r\n    ) {\r\n        super(point, color, constant, 5, board);\r\n    }\r\n\r\n    getPossibleMoves(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row + 1; i < 8; ++i) {\r\n            // dol\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1; i >= 0; --i) {\r\n            // gora\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let j = col - 1; j >= 0; --j) {\r\n            // lewo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let j = col + 1; j < 8; ++j) {\r\n            // prawo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getPossibleCaptures(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row + 1; i < 8; ++i) {\r\n            // dol\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    col,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, col));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, col)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1; i >= 0; --i) {\r\n            // gora\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    col,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, col));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, col)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let j = col - 1; j >= 0; --j) {\r\n            // lewo\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(row, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let j = col + 1; j < 8; ++j) {\r\n            // prawo\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(row, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getCoveredFields(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row + 1; i < 8; ++i) {\r\n            // dol\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                if (!(this.board.getPieceByField instanceof King)) {\r\n                    possiblePoints.push(new Point(i, col));\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1; i >= 0; --i) {\r\n            // gora\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                if (!(this.board.getPieceByField instanceof King)) {\r\n                    possiblePoints.push(new Point(i, col));\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let j = col - 1; j >= 0; --j) {\r\n            // lewo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField instanceof King)) {\r\n                    possiblePoints.push(new Point(row, j));\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let j = col + 1; j < 8; ++j) {\r\n            // prawo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField instanceof King)) {\r\n                    possiblePoints.push(new Point(row, j));\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n}\r\n","import { PieceConstant } from '../../utils/unicode-constants';\r\nimport { Board } from '../board';\r\nimport { Color } from './color';\r\nimport { Piece } from './piece';\r\nimport { Point } from './point';\r\nimport { Rook } from './rook';\r\n\r\nexport class King extends Piece {\r\n    castledAlready = false;\r\n    shortCastled = false;\r\n    longCastled = false;\r\n    isMovedAlready;\r\n    isCastling = false;\r\n\r\n    constructor(\r\n        point: Point,\r\n        color: Color,\r\n        constant: PieceConstant,\r\n        board: Board\r\n    ) {\r\n        super(point, color, constant, 0, board);\r\n    }\r\n\r\n    getPossibleMoves(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n        // lewo\r\n        if (\r\n            this.board.isFieldEmpty(row, col - 1) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row, col - 1));\r\n        }\r\n\r\n        // prawo\r\n        if (\r\n            this.board.isFieldEmpty(row, col + 1) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row, col + 1));\r\n        }\r\n\r\n        // dol\r\n        if (\r\n            this.board.isFieldEmpty(row + 1, col) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row + 1,\r\n                col,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col));\r\n        }\r\n\r\n        // gora\r\n        if (\r\n            this.board.isFieldEmpty(row - 1, col) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row - 1,\r\n                col,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col));\r\n        }\r\n\r\n        // lewo gora\r\n        if (\r\n            this.board.isFieldEmpty(row - 1, col - 1) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row - 1,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col - 1));\r\n        }\r\n        // prawo gora\r\n        if (\r\n            this.board.isFieldEmpty(row - 1, col + 1) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row - 1,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col + 1));\r\n        }\r\n\r\n        // lewo dol\r\n        if (\r\n            this.board.isFieldEmpty(row + 1, col - 1) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row + 1,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col - 1));\r\n        }\r\n        // prawo dol\r\n        if (\r\n            this.board.isFieldEmpty(row + 1, col + 1) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row + 1,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col + 1));\r\n        }\r\n\r\n        if (!this.isMovedAlready) {\r\n            let longCastlePossible = true;\r\n            for (let i = col - 1; i > 0; --i) {\r\n                if (\r\n                    !this.board.isFieldEmpty(row, i) ||\r\n                    this.board.isFieldUnderAttack(\r\n                        row,\r\n                        i,\r\n                        this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                    )\r\n                ) {\r\n                    longCastlePossible = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (longCastlePossible && !this.board.isKingInCheck(\r\n                this.color,\r\n                this.board.pieces\r\n            ) && this.board.getPieceByField(row, 0)) {\r\n                const leftRook = this.board.getPieceByField(row, 0);\r\n                if (leftRook instanceof Rook) {\r\n                    if (!leftRook.isMovedAlready) {\r\n                        possiblePoints.push(new Point(row, col - 2));\r\n                    }\r\n                }\r\n            }\r\n\r\n            let shortCastlePossible = true;\r\n            for (let i = col + 1; i < 7; ++i) {\r\n                if (\r\n                    !this.board.isFieldEmpty(row, i) ||\r\n                    this.board.isFieldUnderAttack(\r\n                        row,\r\n                        i,\r\n                        this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                    )\r\n                ) {\r\n                    shortCastlePossible = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (shortCastlePossible && !this.board.isKingInCheck(\r\n                this.color,\r\n                this.board.pieces\r\n            ) && this.board.getPieceByField(row, 7)) {\r\n                const rightRook = this.board.getPieceByField(row, 7);\r\n                if (rightRook instanceof Rook) {\r\n                    if (!rightRook.isMovedAlready) {\r\n                        possiblePoints.push(new Point(row, col + 2));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getPossibleCaptures(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        // lewo\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row, col - 1));\r\n        }\r\n\r\n        // prawo\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row, col + 1));\r\n        }\r\n\r\n        // dol\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row + 1,\r\n                col,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row + 1,\r\n                col,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col));\r\n        }\r\n\r\n        // gora\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row - 1,\r\n                col,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row - 1,\r\n                col,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col));\r\n        }\r\n\r\n        // lewo gora\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row - 1,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row - 1,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col - 1));\r\n        }\r\n        // prawo gora\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row - 1,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row - 1,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col + 1));\r\n        }\r\n\r\n        // lewo dol\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row + 1,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row + 1,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col - 1));\r\n        }\r\n        // prawo dol\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row + 1,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            ) &&\r\n            !this.board.isFieldUnderAttack(\r\n                row + 1,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col + 1));\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getCoveredFields(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        // lewo\r\n        possiblePoints.push(new Point(row, col - 1));\r\n\r\n        // prawo\r\n        possiblePoints.push(new Point(row, col + 1));\r\n\r\n        // dol\r\n        possiblePoints.push(new Point(row + 1, col));\r\n\r\n        // gora\r\n        possiblePoints.push(new Point(row - 1, col));\r\n\r\n        // lewo gora\r\n        possiblePoints.push(new Point(row - 1, col - 1));\r\n\r\n        // prawo gora\r\n        possiblePoints.push(new Point(row - 1, col + 1));\r\n\r\n        // lewo dol\r\n        possiblePoints.push(new Point(row + 1, col - 1));\r\n\r\n        // prawo dol\r\n        possiblePoints.push(new Point(row + 1, col + 1));\r\n\r\n\r\n        return possiblePoints;\r\n    }\r\n}\r\n","import { PieceConstant } from '../../utils/unicode-constants';\r\nimport { Board } from '../board';\r\nimport { Color } from './color';\r\nimport { King } from './king';\r\nimport { Piece } from './piece';\r\nimport { Point } from './point';\r\n\r\nexport class Bishop extends Piece {\r\n    constructor(\r\n        point: Point,\r\n        color: Color,\r\n        constant: PieceConstant,\r\n        board: Board\r\n    ) {\r\n        super(point, color, constant, 3, board);\r\n    }\r\n\r\n    getPossibleMoves(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row - 1, j = col - 1; i >= 0 && j >= 0; --i, --j) {\r\n            // lewa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1, j = col + 1; i >= 0 && j < 8; --i, ++j) {\r\n            // prawa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col - 1; i < 8 && j >= 0; ++i, --j) {\r\n            // lewa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col + 1; i < 8 && j < 8; ++i, ++j) {\r\n            // prawa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getPossibleCaptures() {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row - 1, j = col - 1; i >= 0 && j >= 0; --i, --j) {\r\n            // lewa gorna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1, j = col + 1; i >= 0 && j < 8; --i, ++j) {\r\n            // prawa gorna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col - 1; i < 8 && j >= 0; ++i, --j) {\r\n            // lewa dolna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col + 1; i < 8 && j < 8; ++i, ++j) {\r\n            // prawa dolna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getCoveredFields(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row - 1, j = col - 1; i >= 0 && j >= 0; --i, --j) {\r\n            // lewa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1, j = col + 1; i >= 0 && j < 8; --i, ++j) {\r\n            // prawa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col - 1; i < 8 && j >= 0; ++i, --j) {\r\n            // lewa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col + 1; i < 8 && j < 8; ++i, ++j) {\r\n            // prawa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n}\r\n","import { PieceConstant } from '../../utils/unicode-constants';\r\nimport { Board } from '../board';\r\nimport { Color } from './color';\r\nimport { Piece } from './piece';\r\nimport { Point } from './point';\r\n\r\nexport class Knight extends Piece {\r\n    isMovedAlready = false;\r\n\r\n    constructor(\r\n        point: Point,\r\n        color: Color,\r\n        constant: PieceConstant,\r\n        board: Board\r\n    ) {\r\n        super(point, color, constant, 3, board);\r\n    }\r\n\r\n    getPossibleMoves(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        // gora -> lewo\r\n        if (this.board.isFieldEmpty(row - 2, col - 1)) {\r\n            possiblePoints.push(new Point(row - 2, col - 1));\r\n        }\r\n\r\n        // gora -> prawo\r\n        if (this.board.isFieldEmpty(row - 2, col + 1)) {\r\n            possiblePoints.push(new Point(row - 2, col + 1));\r\n        }\r\n\r\n        // lewo -> gora\r\n        if (this.board.isFieldEmpty(row - 1, col - 2)) {\r\n            possiblePoints.push(new Point(row - 1, col - 2));\r\n        }\r\n\r\n        // prawo -> gora\r\n        if (this.board.isFieldEmpty(row - 1, col + 2)) {\r\n            possiblePoints.push(new Point(row - 1, col + 2));\r\n        }\r\n\r\n        // lewo -> dol\r\n        if (this.board.isFieldEmpty(row + 1, col - 2)) {\r\n            possiblePoints.push(new Point(row + 1, col - 2));\r\n        }\r\n\r\n        // prawo -> dol\r\n        if (this.board.isFieldEmpty(row + 1, col + 2)) {\r\n            possiblePoints.push(new Point(row + 1, col + 2));\r\n        }\r\n\r\n        // dol -> lewo\r\n        if (this.board.isFieldEmpty(row + 2, col - 1)) {\r\n            possiblePoints.push(new Point(row + 2, col - 1));\r\n        }\r\n\r\n        // dol -> prawo\r\n        if (this.board.isFieldEmpty(row + 2, col + 1)) {\r\n            possiblePoints.push(new Point(row + 2, col + 1));\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getPossibleCaptures(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        // gora -> lewo\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row - 2,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 2, col - 1));\r\n        }\r\n\r\n        // gora -> prawo\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row - 2,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 2, col + 1));\r\n        }\r\n\r\n        // lewo -> gora\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row - 1,\r\n                col - 2,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col - 2));\r\n        }\r\n\r\n        // prawo -> gora\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row - 1,\r\n                col + 2,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col + 2));\r\n        }\r\n\r\n        // lewo -> dol\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row + 1,\r\n                col - 2,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col - 2));\r\n        }\r\n\r\n        // prawo -> dol\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row + 1,\r\n                col + 2,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 1, col + 2));\r\n        }\r\n\r\n        // dol -> lewo\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row + 2,\r\n                col - 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 2, col - 1));\r\n        }\r\n\r\n        // dol -> prawo\r\n        if (\r\n            this.board.isFieldTakenByEnemy(\r\n                row + 2,\r\n                col + 1,\r\n                this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n            )\r\n        ) {\r\n            possiblePoints.push(new Point(row + 2, col + 1));\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getCoveredFields(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        // gora -> lewo\r\n        possiblePoints.push(new Point(row - 2, col - 1));\r\n\r\n        // gora -> prawo\r\n        possiblePoints.push(new Point(row - 2, col + 1));\r\n\r\n        // lewo -> gora\r\n        possiblePoints.push(new Point(row - 1, col - 2));\r\n\r\n        // prawo -> gora\r\n        possiblePoints.push(new Point(row - 1, col + 2));\r\n\r\n        // lewo -> dol\r\n        possiblePoints.push(new Point(row + 1, col - 2));\r\n\r\n        // prawo -> dol\r\n        possiblePoints.push(new Point(row + 1, col + 2));\r\n\r\n        // dol -> lewo\r\n        possiblePoints.push(new Point(row + 2, col - 1));\r\n\r\n        // dol -> prawo\r\n        possiblePoints.push(new Point(row + 2, col + 1));\r\n\r\n        return possiblePoints;\r\n    }\r\n}\r\n","import { PieceConstant } from '../../utils/unicode-constants';\r\nimport { Board } from '../board';\r\nimport { Color } from './color';\r\nimport { Piece } from './piece';\r\nimport { Point } from './point';\r\n\r\nexport class Pawn extends Piece {\r\n    isMovedAlready = false;\r\n\r\n    constructor(\r\n        point: Point,\r\n        color: Color,\r\n        constant: PieceConstant,\r\n        board: Board\r\n    ) {\r\n        super(point, color, constant, 1, board);\r\n    }\r\n\r\n    getPossibleMoves(): Point[] {\r\n        const possiblePoints = [];\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n        if (\r\n            (!this.board.reverted && this.color === Color.WHITE) ||\r\n            (this.board.reverted && this.color === Color.BLACK)\r\n        ) {\r\n            if (this.board.isFieldEmpty(row - 1, col)) {\r\n                possiblePoints.push(new Point(row - 1, col));\r\n\r\n                if (\r\n                    !this.isMovedAlready &&\r\n                    this.board.isFieldEmpty(row - 2, col)\r\n                ) {\r\n                    possiblePoints.push(new Point(row - 2, col));\r\n                }\r\n            }\r\n        } else {\r\n            if (\r\n                /*!board.isFieldTakenByEnemy(row + 1, col, Color.WHITE) &&*/ this.board.isFieldEmpty(\r\n                    row + 1,\r\n                    col\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row + 1, col));\r\n\r\n                if (\r\n                    !this.isMovedAlready &&\r\n                    this.board.isFieldEmpty(row + 2, col)\r\n                ) {\r\n                    possiblePoints.push(new Point(row + 2, col));\r\n                }\r\n            }\r\n        }\r\n        return possiblePoints;\r\n    }\r\n\r\n    getPossibleCaptures(): Point[] {\r\n        const possiblePoints = [];\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        if (\r\n            (!this.board.reverted && this.color === Color.WHITE) ||\r\n            (this.board.reverted && this.color === Color.BLACK)\r\n        ) {\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row - 1,\r\n                    col - 1,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row - 1, col - 1));\r\n            }\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row - 1,\r\n                    col + 1,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row - 1, col + 1));\r\n            }\r\n        } else {\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row + 1,\r\n                    col - 1,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row + 1, col - 1));\r\n            }\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row + 1,\r\n                    col + 1,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row + 1, col + 1));\r\n            }\r\n        }\r\n\r\n        if (\r\n            this.board.enPassantPoint &&\r\n            this.board.enPassantPiece.color ===\r\n                (this.color === Color.WHITE ? Color.BLACK : Color.WHITE)\r\n        ) {\r\n            if (\r\n                row === this.board.enPassantPiece.point.row &&\r\n                Math.abs(this.board.enPassantPiece.point.col - col) === 1\r\n            ) {\r\n                possiblePoints.push(this.board.enPassantPoint);\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getCoveredFields(): Point[] {\r\n        const possiblePoints = [];\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        if (\r\n            (!this.board.reverted && this.color === Color.WHITE) ||\r\n            (this.board.reverted && this.color === Color.BLACK)\r\n        ) {\r\n            possiblePoints.push(new Point(row - 1, col - 1));\r\n\r\n            possiblePoints.push(new Point(row - 1, col + 1));\r\n        } else {\r\n            possiblePoints.push(new Point(row + 1, col - 1));\r\n\r\n            possiblePoints.push(new Point(row + 1, col + 1));\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n}\r\n","import { PieceConstant } from '../../utils/unicode-constants';\r\nimport { Board } from '../board';\r\nimport { Color } from './color';\r\nimport { King } from './king';\r\nimport { Piece } from './piece';\r\nimport { Point } from './point';\r\n\r\nexport class Queen extends Piece {\r\n    constructor(\r\n        point: Point,\r\n        color: Color,\r\n        constant: PieceConstant,\r\n        board: Board\r\n    ) {\r\n        super(point, color, constant, 9, board);\r\n    }\r\n\r\n    getPossibleMoves(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row - 1, j = col - 1; i >= 0 && j >= 0; --i, --j) {\r\n            // lewa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1, j = col + 1; i >= 0 && j < 8; --i, ++j) {\r\n            // prawa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col - 1; i < 8 && j >= 0; ++i, --j) {\r\n            // lewa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col + 1; i < 8 && j < 8; ++i, ++j) {\r\n            // prawa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1; i < 8; ++i) {\r\n            // dol\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1; i >= 0; --i) {\r\n            // gora\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let j = col - 1; j >= 0; --j) {\r\n            // lewo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let j = col + 1; j < 8; ++j) {\r\n            // prawo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n\r\n    getPossibleCaptures(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row - 1, j = col - 1; i >= 0 && j >= 0; --i, --j) {\r\n            // lewa gorna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1, j = col + 1; i >= 0 && j < 8; --i, ++j) {\r\n            // prawa gorna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col - 1; i < 8 && j >= 0; ++i, --j) {\r\n            // lewa dolna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col + 1; i < 8 && j < 8; ++i, ++j) {\r\n            // prawa dolna przekatna\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        for (let i = row + 1; i < 8; ++i) {\r\n            // dol\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    col,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, col));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, col)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1; i >= 0; --i) {\r\n            // gora\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    i,\r\n                    col,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(i, col));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(i, col)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let j = col - 1; j >= 0; --j) {\r\n            // lewo\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(row, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let j = col + 1; j < 8; ++j) {\r\n            // prawo\r\n            if (\r\n                this.board.isFieldTakenByEnemy(\r\n                    row,\r\n                    j,\r\n                    this.color === Color.WHITE ? Color.BLACK : Color.WHITE\r\n                )\r\n            ) {\r\n                possiblePoints.push(new Point(row, j));\r\n                break;\r\n            } else {\r\n                if (!this.board.isFieldEmpty(row, j)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return possiblePoints;\r\n    }\r\n\r\n    getCoveredFields(): Point[] {\r\n        const possiblePoints = [];\r\n\r\n        const row = this.point.row;\r\n        const col = this.point.col;\r\n\r\n        for (let i = row + 1; i < 8; ++i) {\r\n            // dol\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, col) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, col));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1; i >= 0; --i) {\r\n            // gora\r\n            if (this.board.isFieldEmpty(i, col)) {\r\n                possiblePoints.push(new Point(i, col));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, col) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, col));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let j = col - 1; j >= 0; --j) {\r\n            // lewo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(row, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(row, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let j = col + 1; j < 8; ++j) {\r\n            // prawo\r\n            if (this.board.isFieldEmpty(row, j)) {\r\n                possiblePoints.push(new Point(row, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(row, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(row, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1, j = col - 1; i >= 0 && j >= 0; --i, --j) {\r\n            // lewa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row - 1, j = col + 1; i >= 0 && j < 8; --i, ++j) {\r\n            // prawa gorna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col - 1; i < 8 && j >= 0; ++i, --j) {\r\n            // lewa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let i = row + 1, j = col + 1; i < 8 && j < 8; ++i, ++j) {\r\n            // prawa dolna przekatna\r\n            if (this.board.isFieldEmpty(i, j)) {\r\n                possiblePoints.push(new Point(i, j));\r\n            } else {\r\n                if (!(this.board.getPieceByField(i, j) instanceof King)) {\r\n                    possiblePoints.push(new Point(i, j));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return possiblePoints;\r\n    }\r\n}\r\n","export interface PieceConstant {\r\n    name: string;\r\n    icon: string;\r\n}\r\n\r\nexport const UnicodeConstants = {\r\n    WHITE_KING: { name: 'King', icon: '&#x2654;' },\r\n    WHITE_QUEEN: { name: 'Queen', icon: '&#x2655;' },\r\n    WHITE_KNIGHT: { name: 'Knight', icon: '&#x2658' },\r\n    WHITE_ROOK: { name: 'Rook', icon: '&#x2656' },\r\n    WHITE_PAWN: { name: 'Pawn', icon: '&#x2659' },\r\n    WHITE_BISHOP: { name: 'Bishop', icon: '&#x2657' },\r\n\r\n    BLACK_KING: { name: 'King', icon: '&#x265A' },\r\n    BLACK_QUEEN: { name: 'Queen', icon: '&#x265B' },\r\n    BLACK_KNIGHT: { name: 'Knight', icon: '&#x265E' },\r\n    BLACK_ROOK: { name: 'Rook', icon: '&#x265C' },\r\n    BLACK_PAWN: { name: 'Pawn', icon: '&#x265F' },\r\n    BLACK_BISHOP: { name: 'Bishop', icon: '&#x265D' },\r\n};\r\n","import { Board } from '../../../../../models/board';\nimport { Bishop } from '../../../../../models/pieces/bishop';\nimport { Color } from '../../../../../models/pieces/color';\nimport { King } from '../../../../../models/pieces/king';\nimport { Knight } from '../../../../../models/pieces/knight';\nimport { Pawn } from '../../../../../models/pieces/pawn';\nimport { Point } from '../../../../../models/pieces/point';\nimport { Queen } from '../../../../../models/pieces/queen';\nimport { Rook } from '../../../../../models/pieces/rook';\nimport { UnicodeConstants } from '../../../../../utils/unicode-constants';\nimport { AbstractEngineFacade } from '../../../../abstract-engine-facade';\nimport { NotationProcessor } from '../notation-processor';\n\nexport class DefaultFenProcessor implements NotationProcessor {\n\n    public process(notation: string, engineFacade: AbstractEngineFacade): void {\n        let fen = notation;\n        if (notation) {\n            engineFacade.board.reverted = false;\n            engineFacade.board.pieces = [];\n            const split = fen.split('/');\n            for (let i = 0; i < 8; ++i) {\n                let pointer = 0;\n                for (let j = 0; j < 8; ++j) {\n                    const chunk = split[i].charAt(j);\n                    if (chunk.match(/[0-9]/)) {\n                        pointer += Number(chunk);\n                    } else {\n                        switch (chunk) {\n                            case 'r':\n                                engineFacade.board.pieces.push(\n                                    new Rook(\n                                        new Point(i, pointer),\n                                        Color.BLACK,\n                                        UnicodeConstants.BLACK_ROOK,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n                            case 'n':\n                                engineFacade.board.pieces.push(\n                                    new Knight(\n                                        new Point(i, pointer),\n                                        Color.BLACK,\n                                        UnicodeConstants.BLACK_KNIGHT,\n                                        engineFacade.board\n                                    )\n                                );\n\n                                break;\n                            case 'b':\n                                engineFacade.board.pieces.push(\n                                    new Bishop(\n                                        new Point(i, pointer),\n                                        Color.BLACK,\n                                        UnicodeConstants.BLACK_BISHOP,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n                            case 'q':\n                                engineFacade.board.pieces.push(\n                                    new Queen(\n                                        new Point(i, pointer),\n                                        Color.BLACK,\n                                        UnicodeConstants.BLACK_QUEEN,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n                            case 'k':\n                                engineFacade.board.pieces.push(\n                                    new King(\n                                        new Point(i, pointer),\n                                        Color.BLACK,\n                                        UnicodeConstants.BLACK_KING,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n                            case 'p': {\n                                const pawn = new Pawn(\n                                    new Point(i, pointer),\n                                    Color.BLACK,\n                                    UnicodeConstants.BLACK_PAWN,\n                                    engineFacade.board\n                                );\n                                if (\n                                    (pawn.color === Color.BLACK && pawn.point.row !== 1) ||\n                                    (pawn.color === Color.WHITE && pawn.point.row !== 6)\n                                ) {\n                                    pawn.isMovedAlready = true;\n                                }\n                                engineFacade.board.pieces.push(pawn);\n                                break;\n                            }\n                            case 'R':\n                                engineFacade.board.pieces.push(\n                                    new Rook(\n                                        new Point(i, pointer),\n                                        Color.WHITE,\n                                        UnicodeConstants.WHITE_ROOK,\n                                        engineFacade.board\n                                    )\n                                );\n\n                                break;\n                            case 'N':\n                                engineFacade.board.pieces.push(\n                                    new Knight(\n                                        new Point(i, pointer),\n                                        Color.WHITE,\n                                        UnicodeConstants.WHITE_KNIGHT,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n\n                            case 'B':\n                                engineFacade.board.pieces.push(\n                                    new Bishop(\n                                        new Point(i, pointer),\n                                        Color.WHITE,\n                                        UnicodeConstants.WHITE_BISHOP,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n\n                            case 'Q':\n                                engineFacade.board.pieces.push(\n                                    new Queen(\n                                        new Point(i, pointer),\n                                        Color.WHITE,\n                                        UnicodeConstants.WHITE_QUEEN,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n\n                            case 'K':\n                                engineFacade.board.pieces.push(\n                                    new King(\n                                        new Point(i, pointer),\n                                        Color.WHITE,\n                                        UnicodeConstants.WHITE_KING,\n                                        engineFacade.board\n                                    )\n                                );\n                                break;\n\n                            case 'P': {\n                                const pawn = new Pawn(\n                                    new Point(i, pointer),\n                                    Color.WHITE,\n                                    UnicodeConstants.WHITE_PAWN,\n                                    engineFacade.board\n                                );\n                                if (\n                                    (pawn.color === Color.BLACK && pawn.point.row !== 1) ||\n                                    (pawn.color === Color.WHITE && pawn.point.row !== 6)\n                                ) {\n                                    pawn.isMovedAlready = true;\n                                }\n                                engineFacade.board.pieces.push(pawn);\n                                break;\n                            }\n                        }\n                        ++pointer;\n                    }\n                }\n            }\n\n            this.setCurrentPlayer(engineFacade.board, fen);\n            this.setCastles(engineFacade.board, fen);\n            this.setEnPassant(fen);\n            this.setFullMoveCount(fen);\n            engineFacade.board.fen = fen;\n        } else {\n            throw Error('Incorrect FEN provided');\n        }\n    }\n\n\n    private setCurrentPlayer(board: Board, fen: string) {\n        if (fen) {\n            const split = fen.split(' ');\n            board.currentWhitePlayer = split[1] === 'w';\n        }\n    }\n\n    private setCastles(board: Board, fen: string) {\n        if (fen) {\n            const split = fen.split(' ');\n            const castleChunk = split[2];\n\n            if (!castleChunk.includes('K')) {\n                this.setRookAlreadyMoved(board, Color.WHITE, 7);\n            }\n\n            if (!castleChunk.includes('Q')) {\n                this.setRookAlreadyMoved(board, Color.WHITE, 0);\n            }\n\n            if (!castleChunk.includes('k')) {\n                this.setRookAlreadyMoved(board, Color.BLACK, 7);\n            }\n\n            if (!castleChunk.includes('q')) {\n                this.setRookAlreadyMoved(board, Color.BLACK, 0);\n            }\n        }\n    }\n\n    private setFullMoveCount(fen: string) {}\n\n    private setEnPassant(fen: string) {\n        if (fen) {\n            const split = fen.split(' ');\n            const enPassantPoint = split[3];\n\n            if (enPassantPoint === '-') {\n                return;\n            }\n\n            // if()\n        }\n    }\n\n    private setRookAlreadyMoved(board: Board, color: Color, col: number) {\n        const rook = board.pieces.find(\n            (piece) => piece.color === color && piece instanceof Rook && piece.point.col === col\n        ) as Rook;\n\n        if (rook) {\n            rook.isMovedAlready = true;\n        }\n    }\n\n}\n","export class MoveTranslation {\r\n    private _xAxis: number;\r\n    private _yAxis: number;\r\n    private _reverted: boolean;\r\n\r\n    constructor(xAxis: number, yAxis: number, reverted: boolean) {\r\n        this._xAxis = xAxis;\r\n        this._yAxis = yAxis;\r\n        this._reverted = reverted;\r\n    }\r\n\r\n    get xAxis(): number {\r\n        return this._xAxis;\r\n    }\r\n\r\n    set xAxis(value: number) {\r\n        this._xAxis = value;\r\n    }\r\n\r\n    get yAxis(): number {\r\n        return this._yAxis;\r\n    }\r\n\r\n    set yAxis(value: number) {\r\n        this._yAxis = value;\r\n    }\r\n\r\n    get reverted(): boolean {\r\n        return this._reverted;\r\n    }\r\n\r\n    set reverted(value: boolean) {\r\n        this._reverted = value;\r\n    }\r\n}\r\n","import { Board } from '../models/board';\nimport { Color } from '../models/pieces/color';\nimport { King } from '../models/pieces/king';\nimport { Knight } from '../models/pieces/knight';\nimport { Piece } from '../models/pieces/piece';\nimport { Point } from '../models/pieces/point';\nimport { MoveTranslation } from '../models/move-translation';\n\nexport class MoveUtils {\n    public static willMoveCauseCheck(\n        currentColor: Color,\n        row: number,\n        col: number,\n        destRow: number,\n        destCol: number,\n        board: Board\n    ) {\n        const srcPiece = board.getPieceByField(row, col);\n        const destPiece = board.getPieceByField(destRow, destCol);\n\n        if (srcPiece) {\n            srcPiece.point.row = destRow;\n            srcPiece.point.col = destCol;\n        }\n\n        if (destPiece) {\n            board.pieces = board.pieces.filter((piece) => piece !== destPiece);\n        }\n        const isBound = board.isKingInCheck(currentColor, board.pieces);\n\n        if (srcPiece) {\n            srcPiece.point.col = col;\n            srcPiece.point.row = row;\n        }\n\n        if (destPiece) {\n            board.pieces.push(destPiece);\n        }\n\n        return isBound;\n    }\n\n    public static format(\n        sourcePoint: Point,\n        destPoint: Point,\n        reverted: boolean\n    ) {\n        if (reverted) {\n            const sourceX = 104 - sourcePoint.col;\n            const destX = 104 - destPoint.col;\n            return (\n                String.fromCharCode(sourceX) +\n                (sourcePoint.row + 1) +\n                String.fromCharCode(destX) +\n                (destPoint.row + 1)\n            );\n        } else {\n            const incrementX = 97;\n            return (\n                String.fromCharCode(sourcePoint.col + incrementX) +\n                (Math.abs(sourcePoint.row - 7) + 1) +\n                String.fromCharCode(destPoint.col + incrementX) +\n                (Math.abs(destPoint.row - 7) + 1)\n            );\n        }\n    }\n\n    public static translateCoordsToIndex(coords: string, reverted: boolean) {\n        let xAxis: number;\n        let yAxis: number;\n        if (reverted) {\n            xAxis = 104 - coords.charCodeAt(0);\n            yAxis = +coords.charAt(1) - 1;\n        } else {\n            xAxis = coords.charCodeAt(0) - 97;\n            yAxis = Math.abs(+coords.charAt(1) - 8);\n        }\n\n        return new MoveTranslation(xAxis, yAxis, reverted);\n    }\n\n    public static findPieceByPossibleMovesContaining(\n        coords: string,\n        board: Board,\n        color: Color\n    ): Piece[] {\n        let indexes = this.translateCoordsToIndex(coords, board.reverted);\n        let destPoint = new Point(indexes.yAxis, indexes.xAxis);\n        let foundPieces = [];\n\n        for (let piece of board.pieces.filter(piece => piece.color === color)) {\n            for (let point of piece.getPossibleMoves()) {\n                if (!MoveUtils.willMoveCauseCheck(\n                    piece.color,\n                    piece.point.row,\n                    piece.point.col,\n                    indexes.yAxis,\n                    indexes.xAxis,\n                    board\n                ) && point.isEqual(destPoint)) {\n                    foundPieces.push(piece);\n                }\n            }\n        }\n        if (foundPieces.length === 0) {\n            console.log(coords + ' debug');\n        }\n        return foundPieces;\n    }\n\n    public static findPieceByPossibleCapturesContaining(\n        coords: string,\n        board: Board,\n        color: Color\n    ): Piece[] {\n        let indexes = this.translateCoordsToIndex(coords, board.reverted);\n        let destPoint = new Point(indexes.yAxis, indexes.xAxis);\n        let foundPieces = [];\n        for (let piece of board.pieces.filter(piece => piece.color === color)) {\n            for (let point of piece.getPossibleCaptures()) {\n                if (!MoveUtils.willMoveCauseCheck(\n                    piece.color,\n                    piece.point.row,\n                    piece.point.col,\n                    indexes.yAxis,\n                    indexes.xAxis,\n                    board\n                ) && point.isEqual(destPoint)) {\n                    foundPieces.push(piece);\n                }\n            }\n        }\n        if (foundPieces.length === 0) {\n            console.log(coords + ' debug');\n        }\n\n        return foundPieces;\n    }\n\n    public static formatSingle(point: Point, reverted: boolean): string {\n        if (reverted) {\n            const sourceX = 104 - point.col;\n            return (\n                String.fromCharCode(sourceX) +\n                (point.row + 1)\n            );\n        } else {\n            const incrementX = 97;\n            return (\n                String.fromCharCode(point.col + incrementX) +\n                (Math.abs(point.row - 7) + 1)\n            );\n        }\n    }\n\n}\n","import { Board } from '../../../models/board';\nimport { Bishop } from '../../../models/pieces/bishop';\nimport { Color } from '../../../models/pieces/color';\nimport { King } from '../../../models/pieces/king';\nimport { Knight } from '../../../models/pieces/knight';\nimport { Pawn } from '../../../models/pieces/pawn';\nimport { Point } from '../../../models/pieces/point';\nimport { Queen } from '../../../models/pieces/queen';\nimport { Rook } from '../../../models/pieces/rook';\nimport { UnicodeConstants } from '../../../utils/unicode-constants';\n\nexport class DefaultPiecesLoader {\n\n    static loadDefaultPieces(board: Board) {\n        board.pieces = [];\n        // piony czarne\n        for (let i = 0; i < 8; ++i) {\n            board.pieces.push(new Pawn(\n                new Point(1, i),\n                Color.BLACK,\n                UnicodeConstants.BLACK_PAWN,\n                board\n            ));\n        }\n        board.pieces.push(new Rook(\n            new Point(0, 0),\n            Color.BLACK,\n            UnicodeConstants.BLACK_ROOK,\n            board\n        ));\n        board.pieces.push(new Knight(\n            new Point(0, 1),\n            Color.BLACK,\n            UnicodeConstants.BLACK_KNIGHT,\n            board\n        ));\n        board.pieces.push(new Bishop(\n            new Point(0, 2),\n            Color.BLACK,\n            UnicodeConstants.BLACK_BISHOP,\n            board\n        ));\n        board.pieces.push(new Queen(\n            new Point(0, 3),\n            Color.BLACK,\n            UnicodeConstants.BLACK_QUEEN,\n            board\n        ));\n        board.pieces.push(new King(\n            new Point(0, 4),\n            Color.BLACK,\n            UnicodeConstants.BLACK_KING,\n            board\n        ));\n        board.pieces.push(new Bishop(\n            new Point(0, 5),\n            Color.BLACK,\n            UnicodeConstants.BLACK_BISHOP,\n            board\n        ));\n        board.pieces.push(new Knight(\n            new Point(0, 6),\n            Color.BLACK,\n            UnicodeConstants.BLACK_KNIGHT,\n            board\n        ));\n        board.pieces.push(new Rook(\n            new Point(0, 7),\n            Color.BLACK,\n            UnicodeConstants.BLACK_ROOK,\n            board\n        ));\n\n        // piony biale\n        for (let i = 0; i < 8; ++i) {\n            board.pieces.push(new Pawn(\n                new Point(6, i),\n                Color.WHITE,\n                UnicodeConstants.WHITE_PAWN,\n                board\n            ));\n        }\n        board.pieces.push(new Rook(\n            new Point(7, 0),\n            Color.WHITE,\n            UnicodeConstants.WHITE_ROOK,\n            board\n        ));\n        board.pieces.push(new Knight(\n            new Point(7, 1),\n            Color.WHITE,\n            UnicodeConstants.WHITE_KNIGHT,\n            board\n        ));\n        board.pieces.push(new Bishop(\n            new Point(7, 2),\n            Color.WHITE,\n            UnicodeConstants.WHITE_BISHOP,\n            board\n        ));\n        board.pieces.push(new Queen(\n            new Point(7, 3),\n            Color.WHITE,\n            UnicodeConstants.WHITE_QUEEN,\n            board\n        ));\n        board.pieces.push(new King(\n            new Point(7, 4),\n            Color.WHITE,\n            UnicodeConstants.WHITE_KING,\n            board\n        ));\n        board.pieces.push(new Bishop(\n            new Point(7, 5),\n            Color.WHITE,\n            UnicodeConstants.WHITE_BISHOP,\n            board\n        ));\n        board.pieces.push(new Knight(\n            new Point(7, 6),\n            Color.WHITE,\n            UnicodeConstants.WHITE_KNIGHT,\n            board\n        ));\n        board.pieces.push(new Rook(\n            new Point(7, 7),\n            Color.WHITE,\n            UnicodeConstants.WHITE_ROOK,\n            board\n        ));\n\n        board.calculateFEN();\n\n    }\n\n}\n","import { Board } from '../../../../../models/board';\nimport { Bishop } from '../../../../../models/pieces/bishop';\nimport { Color } from '../../../../../models/pieces/color';\nimport { King } from '../../../../../models/pieces/king';\nimport { Knight } from '../../../../../models/pieces/knight';\nimport { Pawn } from '../../../../../models/pieces/pawn';\nimport { Piece } from '../../../../../models/pieces/piece';\nimport { Point } from '../../../../../models/pieces/point';\nimport { Queen } from '../../../../../models/pieces/queen';\nimport { Rook } from '../../../../../models/pieces/rook';\nimport { MoveUtils } from '../../../../../utils/move-utils';\nimport { AbstractEngineFacade } from '../../../../abstract-engine-facade';\nimport { DefaultPiecesLoader } from '../../default-pieces-loader';\nimport { NotationProcessor } from '../notation-processor';\n\nexport class DefaultPgnProcessor implements NotationProcessor {\n\n    public process(notation: string, engineFacade: AbstractEngineFacade): void {\n        if (notation) {\n            engineFacade.board.reverted = false;\n            engineFacade.board.pieces = [];\n            engineFacade.reset();\n            DefaultPiecesLoader.loadDefaultPieces(engineFacade.board);\n            let moves = this.extractMoves(notation);\n            let counter = -1;\n            for (let move of moves) {\n                ++counter;\n                move = move.replace(/[+#]/g, '');\n                let promotionIndex = '';\n\n                if (move.includes('=')) {\n                    promotionIndex = this.resolvePromotion(move.substring(move.length - 1));\n                    move = move.substring(0, move.length - 2);\n                }\n\n                let color = (counter === 0 || counter % 2 === 0)\n                    ? Color.WHITE\n                    : Color.BLACK;\n\n                if (/^[a-z]\\d$/g.test(move)) { // zwykly ruch na wolne pole e4\n                    let piece = MoveUtils.findPieceByPossibleMovesContaining(\n                        move,\n                        engineFacade.board,\n                        color\n                    ).find(piece => piece instanceof Pawn);\n                    if (piece) {\n                        engineFacade.move(MoveUtils.formatSingle(\n                            piece.point,\n                            false\n                        ) + move + promotionIndex);\n                    } else {\n                    }\n                } else {\n                    if (/^[A-Z][a-h]\\d$/g.test(move)) {// jezeli ma wielka litere, czyli trzeba odszukac ktora figura Nf3\n                        let pieces = MoveUtils.findPieceByPossibleMovesContaining(\n                            move.substring(1),\n                            engineFacade.board,\n                            color\n                        );\n                        let piece = pieces.find(piece => this.resolvePieceByFirstChar(\n                            move.charAt(0),\n                            piece\n                        ));\n                        if (piece) {\n                            engineFacade.move(MoveUtils.formatSingle(\n                                piece.point,\n                                false\n                            ) + move.substring(1) + promotionIndex);\n                        } else {\n                        }\n                    } else {\n                        if ('O-O' === move) {\n                            engineFacade.move(color === Color.WHITE ? 'e1g1' : 'e8g8');\n                        } else {\n                            if (/^[a-z]x[a-z]\\d$/g.test(move)) { //exd5\n                                let pieces = MoveUtils.findPieceByPossibleCapturesContaining(\n                                    move.substring(move.indexOf('x') + 1),\n                                    engineFacade.board,\n                                    color\n                                ).filter(piece => piece instanceof Pawn);\n\n                                let piece;\n                                if (pieces.length > 1) {\n                                    piece = this.resolveByCol(\n                                        pieces,\n                                        move.substring(0, 1)\n                                    );\n                                } else {\n                                    piece = pieces[0];\n                                }\n\n                                if (piece) {\n                                    engineFacade.move(MoveUtils.formatSingle(\n                                        piece.point,\n                                        false\n                                    ) + move.substring(move.indexOf('x') + 1) + promotionIndex);\n                                } else {\n                                }\n                            } else {\n                                if (/^[A-Z]x[a-z]\\d$/g.test(move)) {\n                                    let piece = MoveUtils.findPieceByPossibleCapturesContaining(\n                                        move.substring(move.indexOf('x') + 1),\n                                        engineFacade.board,\n                                        color\n                                    ).find(piece => this.resolvePieceByFirstChar(\n                                        move.substring(0, 1),\n                                        piece\n                                    ));\n                                    if (piece) {\n                                        engineFacade.move(MoveUtils.formatSingle(\n                                            piece.point,\n                                            false\n                                        ) + move.substring(move.indexOf('x') + 1) + promotionIndex);\n                                    } else {\n                                    }\n                                } else {\n                                    if (move === 'O-O-O') {\n                                        engineFacade.move(color === Color.WHITE ? 'e1c1' : 'e8c8');\n                                    } else {\n                                        if (/^[A-Z]\\dx[a-z]\\d$/g.test(move)) {  //Ngxe4 sytuacja 2 skoczkow pion bicie\n                                            let pieces = MoveUtils.findPieceByPossibleCapturesContaining(\n                                                move.substring(move.indexOf('x') + 1),\n                                                engineFacade.board,\n                                                color\n                                            ).filter(piece => this.resolvePieceByFirstChar(\n                                                move.charAt(0),\n                                                piece\n                                            ));\n\n                                            let piece = this.resolveByRow(\n                                                pieces,\n                                                move.substring(1, 2)\n                                            );\n\n                                            if (piece) {\n                                                engineFacade.move(MoveUtils.formatSingle(\n                                                    piece.point,\n                                                    false\n                                                ) + move.substring(move.indexOf(\n                                                    'x') + 1) + promotionIndex);\n                                            }\n                                        } else {\n                                            if (/^[A-Z][a-z][a-z]\\d$/g.test(move)) { // dwie wieze bez bicia Rac1 pion\n                                                let pieces = MoveUtils.findPieceByPossibleMovesContaining(\n                                                    move.substring(2, 4),\n                                                    engineFacade.board,\n                                                    color\n                                                ).filter(piece => this.resolvePieceByFirstChar(\n                                                    move.charAt(0),\n                                                    piece\n                                                ));\n\n                                                let piece = this.resolveByCol(\n                                                    pieces,\n                                                    move.substring(1, 2)\n                                                );\n\n                                                if (piece) {\n                                                    engineFacade.move(MoveUtils.formatSingle(\n                                                        piece.point,\n                                                        false\n                                                    ) + move.substring(\n                                                        2,\n                                                        4\n                                                    ) + promotionIndex);\n                                                }\n                                            } else {\n                                                if (/^[A-Z][a-z]x[a-z]\\d$/g.test(\n                                                    move)) {\n                                                    let pieces = MoveUtils.findPieceByPossibleCapturesContaining(\n                                                        move.substring(move.indexOf(\n                                                            'x') + 1),\n                                                        engineFacade.board,\n                                                        color\n                                                    ).filter(piece => this.resolvePieceByFirstChar(\n                                                        move.charAt(0),\n                                                        piece\n                                                    ));\n\n                                                    let piece = this.resolveByCol(\n                                                        pieces,\n                                                        move.substring(1, 2)\n                                                    );\n\n                                                    if (piece) {\n                                                        engineFacade.move(\n                                                            MoveUtils.formatSingle(\n                                                                piece.point,\n                                                                false\n                                                            ) + move.substring(\n                                                            move.indexOf(\n                                                                'x') + 1) + promotionIndex);\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    protected extractMoves(notation: string) {\n        return notation.substring(notation.lastIndexOf(']') + 1)\n            .replace(/[0-9]+\\./g, '')\n            .replace(/\\s+/g, ' ')\n            .replace(/{[^}]*}/g, '')\n            .trim()\n            .split(' ')\n            .filter(s => s);\n    }\n\n    protected movePiece(piece: Piece, board: Board, move: string) {\n        let indexes = MoveUtils.translateCoordsToIndex(move, board.reverted);\n        piece.point.col = indexes.xAxis;\n        piece.point.row = indexes.yAxis;\n    }\n\n    hasUpperCase(move: string) {\n        return /[A-Z]/.test(move);\n    }\n\n    private resolvePieceByFirstChar(move: string, piece: Piece) {\n        let piecesFirstChar = '';\n        if (piece instanceof King) {\n            piecesFirstChar = 'K';\n        } else {\n            if (piece instanceof Queen) {\n                piecesFirstChar = 'Q';\n            } else {\n                if (piece instanceof Rook) {\n                    piecesFirstChar = 'R';\n                } else {\n                    if (piece instanceof Bishop) {\n                        piecesFirstChar = 'B';\n                    } else {\n                        if (piece instanceof Knight) {\n                            piecesFirstChar = 'N';\n                        } else {\n                            if (piece instanceof Pawn) {\n                                piecesFirstChar = 'P';\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        return move === piecesFirstChar;\n    }\n\n    private isShortCastle(move: string) {\n        return move === 'O-O';\n    }\n\n    private removePiece(coords: string, board: Board) {\n        let indexes = MoveUtils.translateCoordsToIndex(coords, board.reverted);\n\n        board.pieces = board.pieces.filter(e => !e.point.isEqual(new Point(\n            indexes.yAxis,\n            indexes.xAxis\n        )));\n    }\n\n    private isLongCastle(move: string) {\n        return move === 'O-O-O';\n    }\n\n    private resolveByCol(pieces: Piece[], char: string): Piece {\n        let firstPieceFormat = MoveUtils.formatSingle(pieces[0].point, false);\n        let secondPieceFormat = MoveUtils.formatSingle(pieces[1].point, false);\n        return firstPieceFormat.substring(0, 1) === char\n            ? pieces[0]\n            : pieces[1];\n    }\n\n    private resolveByRow(pieces: Piece[], char: string) {\n        let firstPieceFormat = MoveUtils.formatSingle(pieces[0].point, false);\n        let secondPieceFormat = MoveUtils.formatSingle(pieces[1].point, false);\n        return firstPieceFormat.substring(1, 2) === char\n            ? pieces[0]\n            : pieces[1];\n    }\n\n    private replacePromotion(move: string) {\n        return move\n            .replace('=Q', '1')\n            .replace('=R', '2')\n            .replace('=B', '3')\n            .replace('=K', '4');\n    }\n\n    private resolvePromotion(promotionChar: string) {\n        switch (promotionChar) {\n            case 'Q':\n                return '1';\n            case 'R':\n                return '2';\n            case 'B':\n                return '3';\n            case 'N':\n                return '4';\n        }\n        return '';\n    }\n}\n","export class DrawPoint {\r\n    x: number;\r\n    y: number;\r\n    color: string;\r\n\r\n    constructor(x: number, y: number, color: string) {\r\n        this.x = x + 0.5;\r\n        this.y = y + 0.5;\r\n        this.color = color;\r\n    }\r\n\r\n    isEqual(that: DrawPoint) {\r\n        return that && that.x === this.x && this.y === that.y;\r\n    }\r\n}\r\n","import { Point } from '../../models/pieces/point';\r\nimport { ColorStrategy } from '../drawing-tools/colors/color-strategy';\r\nimport { DrawPoint } from '../drawing-tools/draw-point';\r\n\r\nexport class ClickUtils {\r\n\r\n    static getClickPoint(\r\n        event: any,\r\n        top: number,\r\n        height: number,\r\n        left: number,\r\n        width: number\r\n    ) {\r\n        return new Point(\r\n            Math.floor((event.y - top) / (height / 8)),\r\n            Math.floor((event.x - left) / (width / 8)\r\n            )\r\n        );\r\n    }\r\n\r\n    static getDrawingPoint(\r\n        tileSize: number,\r\n        colorStrategy: ColorStrategy,\r\n        x: number,\r\n        y: number,\r\n        ctrl: boolean,\r\n        alt: boolean,\r\n        shift: boolean,\r\n        xAxis: number,\r\n        yAxis: number\r\n    ) {\r\n        const squareSize = tileSize / 8;\r\n        const xx = Math.floor(\r\n            (x - xAxis) /\r\n            squareSize\r\n        );\r\n        const yy = Math.floor(\r\n            (y - yAxis) /\r\n            squareSize\r\n        );\r\n\r\n        let color = colorStrategy.resolve(ctrl, shift, alt);\r\n\r\n        return new DrawPoint(\r\n            Math.floor(xx * squareSize + squareSize / 2),\r\n            Math.floor(yy * squareSize + squareSize / 2),\r\n            color\r\n        );\r\n    }\r\n\r\n}\r\n","export class HistoryMove {\r\n    move: string;\r\n    piece: string;\r\n    color: string;\r\n    x: boolean;\r\n\r\n    constructor(move: string, piece: string, color: string, captured: boolean) {\r\n        this.move = move;\r\n        this.piece = piece;\r\n        this.color = color;\r\n        this.x = captured;\r\n    }\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\nimport { HistoryMove } from './history-move';\r\n\r\nexport class HistoryMoveProvider {\r\n    historyMovesSubject$ = new BehaviorSubject<HistoryMove[]>([]);\r\n\r\n    get historyMoves(): HistoryMove[] {\r\n        return this.historyMovesSubject$.value;\r\n    }\r\n\r\n    set historyMoves(states: HistoryMove[]) {\r\n        this.historyMovesSubject$.next(states);\r\n    }\r\n\r\n    addMove(historyMove: HistoryMove) {\r\n        this.historyMoves = [...this.historyMoves, historyMove];\r\n    }\r\n\r\n    pop(): HistoryMove {\r\n        const lastHistoryMove = this.getLastMove();\r\n        this.historyMoves = this.historyMoves.filter(\r\n            (state) => state !== lastHistoryMove\r\n        );\r\n        return lastHistoryMove;\r\n    }\r\n\r\n    getAll() {\r\n        return this.historyMoves;\r\n    }\r\n\r\n    clear() {\r\n        this.historyMoves = [];\r\n    }\r\n\r\n    getLastMove() {\r\n        return this.historyMoves[this.getLastMoveIndex()];\r\n    }\r\n\r\n    getLastMoveIndex() {\r\n        return this.historyMoves.length - 1;\r\n    }\r\n}\r\n","export class Constants {\n    static readonly DEFAULT_DARK_TILE_COLOR = 'rgb(97, 84, 61)';\n    static readonly DEFAULT_LIGHT_TILE_COLOR = '#BAA378';\n\n    static readonly DEFAULT_SIZE = 500;\n    static readonly MIN_BOARD_SIZE = 100;\n    static readonly MAX_BOARD_SIZE = 4000;\n\n}\n","import { Bishop } from '../../models/pieces/bishop';\r\nimport { Color } from '../../models/pieces/color';\r\nimport { King } from '../../models/pieces/king';\r\nimport { Knight } from '../../models/pieces/knight';\r\nimport { Pawn } from '../../models/pieces/pawn';\r\nimport { Piece } from '../../models/pieces/piece';\r\nimport { Queen } from '../../models/pieces/queen';\r\nimport { Rook } from '../../models/pieces/rook';\r\nimport { PieceIconInput } from './piece-icon-input';\r\n\r\nexport class PieceIconInputManager {\r\n\r\n    private _defaultIcons: boolean = false;\r\n    private _pieceIconInput: PieceIconInput;\r\n\r\n    get pieceIconInput(): PieceIconInput {\r\n        return this._pieceIconInput;\r\n    }\r\n\r\n    set pieceIconInput(value: PieceIconInput) {\r\n        this._pieceIconInput = value;\r\n    }\r\n\r\n\r\n    get defaultIcons(): boolean {\r\n        return this._defaultIcons;\r\n    }\r\n\r\n    set defaultIcons(value: boolean) {\r\n        this._defaultIcons = value;\r\n    }\r\n\r\n    isDefaultIcons(): boolean {\r\n        return this.pieceIconInput === undefined || this.pieceIconInput === null;\r\n    }\r\n\r\n    getPieceIcon(piece: Piece): string {\r\n        let isWhite = (piece.color === Color.WHITE);\r\n        switch (piece.constructor) {\r\n            case King:\r\n                return isWhite ? this.pieceIconInput.whiteKingUrl : this.pieceIconInput.blackKingUrl;\r\n            case Queen:\r\n                return isWhite ? this.pieceIconInput.whiteQueenUrl : this.pieceIconInput.blackQueenUrl;\r\n            case Rook:\r\n                return isWhite ? this.pieceIconInput.whiteRookUrl : this.pieceIconInput.blackRookUrl;\r\n            case Bishop:\r\n                return isWhite ? this.pieceIconInput.whiteBishopUrl : this.pieceIconInput.blackBishopUrl;\r\n            case Knight:\r\n                return isWhite ? this.pieceIconInput.whiteKnightUrl : this.pieceIconInput.blackKnightUrl;\r\n            case Pawn:\r\n                return isWhite ? this.pieceIconInput.whitePawnUrl : this.pieceIconInput.blackPawnUrl;\r\n        }\r\n    }\r\n\r\n    loadDefaultData(){\r\n        this.pieceIconInput = {\r\n            blackBishopUrl: '',\r\n            blackKingUrl: '',\r\n            blackKnightUrl: '',\r\n            blackQueenUrl: '',\r\n            blackRookUrl: '',\r\n            whiteBishopUrl: '',\r\n            whiteKingUrl: '',\r\n            whiteKnightUrl: '',\r\n            whitePawnUrl: '',\r\n            whiteQueenUrl: '',\r\n            whiteRookUrl: '',\r\n            blackPawnUrl: 'a'\r\n        }\r\n    }\r\n\r\n}\r\n","export enum PieceTypeInput {\r\n\r\n    KING = 1,\r\n    QUEEN = 2,\r\n    BISHOP = 3,\r\n    KNIGHT = 4,\r\n    ROOK = 5,\r\n    PAWN = 6\r\n\r\n}\r\n\r\nexport enum ColorInput {\r\n\r\n    LIGHT = 1,\r\n    DARK = 2\r\n\r\n}\r\n","export class CoordsProvider {\r\n    private readonly defaultXCoords: string[] = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\r\n\r\n    private readonly defaultYCoords: number[] = [8, 7, 6, 5, 4, 3, 2, 1];\r\n\r\n    private currentXCoords: string[] = [...this.defaultXCoords];\r\n    private currentYCoords: number[] = [...this.defaultYCoords];\r\n\r\n    get xCoords(): string[] {\r\n        return this.currentXCoords;\r\n    }\r\n\r\n    get yCoords(): number[] {\r\n        return this.currentYCoords;\r\n    }\r\n\r\n    reverse() {\r\n        this.currentXCoords = this.currentXCoords.reverse();\r\n        this.currentYCoords = this.currentYCoords.reverse();\r\n    }\r\n\r\n    reset() {\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        this.currentXCoords = [...this.defaultXCoords];\r\n        this.currentYCoords = [...this.defaultYCoords];\r\n    }\r\n}\r\n","import { CdkDragEnd, CdkDragStart } from '@angular/cdk/drag-drop';\r\nimport { DragEndProcessor } from './drag-end-processor';\r\n\r\nexport class DefaultDragEndProcessor implements DragEndProcessor {\r\n\r\n    dragEnded(event: CdkDragEnd) {\r\n        event.source.reset();\r\n        event.source.element.nativeElement.style.zIndex = '0';\r\n        event.source.element.nativeElement.style.pointerEvents = 'auto';\r\n        event.source.element.nativeElement.style.touchAction = 'auto';\r\n    }\r\n\r\n}\r\n","import { CdkDragEnd } from '@angular/cdk/drag-drop';\r\nimport { DefaultDragEndProcessor } from './default-drag-end-processor';\r\nimport { DragEndProcessor } from './drag-end-processor';\r\n\r\nexport class DragEndStrategy {\r\n\r\n    private dragEndProcessor: DragEndProcessor;\r\n\r\n    constructor() {\r\n        this.dragEndProcessor = new DefaultDragEndProcessor();\r\n    }\r\n\r\n    public process(event: CdkDragEnd): void {\r\n        this.dragEndProcessor.dragEnded(event);\r\n    }\r\n\r\n    setDragEndProcessor(processor: DragEndProcessor) {\r\n        this.dragEndProcessor = processor;\r\n    }\r\n\r\n}\r\n","import { CdkDragStart } from '@angular/cdk/drag-drop';\nimport { DragStartProcessor } from './drag-start-processor';\n\nexport class DefaultDragStartProcessor implements DragStartProcessor {\n\n    dragStarted(event: CdkDragStart) {\n        const style = event.source.element.nativeElement.style;\n        style.position = 'relative';\n        style.zIndex = '1000';\n        style.touchAction = 'none';\n        style.pointerEvents = 'none';\n    }\n\n}\n","import { CdkDragStart } from '@angular/cdk/drag-drop';\r\nimport { DefaultDragStartProcessor } from './default-drag-start-processor';\r\nimport { DragStartProcessor } from './drag-start-processor';\r\n\r\nexport class DragStartStrategy {\r\n\r\n    private dragStartProcessor: DragStartProcessor;\r\n\r\n    constructor() {\r\n        this.dragStartProcessor = new DefaultDragStartProcessor();\r\n    }\r\n\r\n    public process(event: CdkDragStart): void {\r\n        this.dragStartProcessor.dragStarted(event);\r\n    }\r\n\r\n    setDragStartProcessor(processor: DragStartProcessor) {\r\n        this.dragStartProcessor = processor;\r\n    }\r\n\r\n}\r\n","import { ColorProcessor } from './color-processor';\r\n\r\nexport class DefaultColorProcessor implements ColorProcessor{\r\n\r\n    resolve(ctrl: any, shift: any, alt: any): string{\r\n        let color = 'green';\r\n\r\n        if (ctrl || shift) {\r\n            color = 'red';\r\n        }\r\n        if (alt) {\r\n            color = 'blue';\r\n        }\r\n        if ((shift || ctrl) && alt) {\r\n            color = 'orange';\r\n        }\r\n\r\n        return color;\r\n    }\r\n\r\n}\r\n","import { ColorProcessor } from './color-processor';\r\nimport { DefaultColorProcessor } from './default-color-processor';\r\n\r\nexport class ColorStrategy {\r\n\r\n    colorProcessor: ColorProcessor;\r\n\r\n    constructor() {\r\n        this.colorProcessor = new DefaultColorProcessor();\r\n    }\r\n\r\n    resolve(ctrl: any, shift: any, alt: any) {\r\n        return this.colorProcessor.resolve(ctrl, shift, alt);\r\n    }\r\n\r\n    setColorProcessor(colorProcessor: ColorProcessor) {\r\n        this.colorProcessor = colorProcessor;\r\n    }\r\n\r\n}\r\n","import { BehaviorSubject } from 'rxjs';\r\nimport { Arrow } from './shapes/arrow';\r\nimport { Circle } from './shapes/circle';\r\n\r\nexport class DrawProvider {\r\n    private arrowsSubject$ = new BehaviorSubject<Arrow[]>([]);\r\n    private circlesSubject$ = new BehaviorSubject<Circle[]>([]);\r\n\r\n    public arrows$ = this.arrowsSubject$.asObservable();\r\n    public circles$ = this.circlesSubject$.asObservable();\r\n\r\n    private get circles(): Circle[] {\r\n        return this.circlesSubject$.value;\r\n    }\r\n\r\n    private set circles(circles: Circle[]) {\r\n        this.circlesSubject$.next(circles);\r\n    }\r\n\r\n    private get arrows(): Arrow[] {\r\n        return this.arrowsSubject$.value;\r\n    }\r\n\r\n    private set arrows(arrows: Arrow[]) {\r\n        this.arrowsSubject$.next(arrows);\r\n    }\r\n\r\n    addCircle(circle: Circle) {\r\n        this.circles = [...this.circles, circle];\r\n    }\r\n\r\n    reomveCircle(removeCircle: Circle) {\r\n        this.circles = this.circles.filter((circle) => !circle.isEqual(removeCircle));\r\n    }\r\n\r\n    addArrow(arrow: Arrow) {\r\n        this.arrows = [...this.arrows, arrow];\r\n    }\r\n\r\n    removeArrow(removeArrow: Arrow) {\r\n        this.arrows = this.arrows.filter((arrow) => !arrow.isEqual(removeArrow));\r\n    }\r\n\r\n    containsCircle(checkCircle: Circle) {\r\n        return this.circles.some((circle) => circle.isEqual(checkCircle));\r\n    }\r\n\r\n    containsArrow(checkArrow: Arrow) {\r\n        return this.arrows.some((arrow: Arrow) => arrow.isEqual(checkArrow));\r\n    }\r\n\r\n    clear() {\r\n        this.arrows = [];\r\n        this.circles = [];\r\n    }\r\n}\r\n","import { PiecePromotionModalComponent } from '../piece-promotion/piece-promotion-modal/piece-promotion-modal.component';\nimport { HistoryMove } from '../history-move-provider/history-move';\nimport { HistoryMoveProvider } from '../history-move-provider/history-move-provider';\nimport { Board } from '../models/board';\nimport { King } from '../models/pieces/king';\nimport { Pawn } from '../models/pieces/pawn';\nimport { Piece } from '../models/pieces/piece';\nimport { Point } from '../models/pieces/point';\nimport { Rook } from '../models/pieces/rook';\nimport { Constants } from '../utils/constants';\nimport { PieceIconInputManager } from '../utils/inputs/piece-icon-input-manager';\nimport { ColorInput, PieceTypeInput } from '../utils/inputs/piece-type-input';\nimport { BoardLoader } from './board-state-provider/board-loader/board-loader';\nimport { CoordsProvider } from './coords/coords-provider';\nimport { DragEndStrategy } from './drag/end/drag-end-strategy';\nimport { DragStartStrategy } from './drag/start/drag-start-strategy';\nimport { ColorStrategy } from './drawing-tools/colors/color-strategy';\nimport { DrawProvider } from './drawing-tools/draw-provider';\n\nexport abstract class AbstractEngineFacade {\n\n    public dragStartStrategy: DragStartStrategy = new DragStartStrategy();\n    public dragEndStrategy: DragEndStrategy = new DragEndStrategy();\n    protected colorStrategy: ColorStrategy = new ColorStrategy();\n\n    public coords: CoordsProvider = new CoordsProvider();\n    public heightAndWidth: number = Constants.DEFAULT_SIZE;\n\n    public freeMode = false;\n    public dragDisabled: boolean;\n    public drawDisabled: boolean;\n    public lightDisabled: boolean;\n    public darkDisabled: boolean;\n    public board: Board;\n    public modal: PiecePromotionModalComponent;\n    public boardLoader: BoardLoader;\n    public drawProvider: DrawProvider = new DrawProvider();\n    public pieceIconManager: PieceIconInputManager = new PieceIconInputManager();\n    public moveHistoryProvider: HistoryMoveProvider = new HistoryMoveProvider();\n\n    protected constructor(board: Board) {\n        this.board = board;\n    }\n\n    public abstract reset(): void;\n\n    public abstract undo(): void;\n\n    public abstract move(coords: string): void;\n\n    public abstract addPiece(\n        pieceTypeInput: PieceTypeInput,\n        colorInput: ColorInput,\n        coords: string\n    ): void;\n\n    public abstract onMouseUp(\n        event: MouseEvent,\n        pointClicked: Point,\n        left: number,\n        top: number\n    ): void;\n\n    public abstract onMouseDown(\n        event: MouseEvent,\n        pointClicked: Point,\n        left?: number,\n        top?: number\n    ): void;\n\n    public checkIfPawnFirstMove(piece: Piece) {\n        if (piece instanceof Pawn) {\n            piece.isMovedAlready = true;\n        }\n    }\n\n    public checkIfRookMoved(piece: Piece) {\n        if (piece instanceof Rook) {\n            piece.isMovedAlready = true;\n        }\n    }\n\n    public checkIfKingMoved(piece: Piece) {\n        if (piece instanceof King) {\n            piece.isMovedAlready = true;\n        }\n    }\n\n    public getMoveHistory(): HistoryMove[] {\n        return this.moveHistoryProvider.getAll();\n    }\n\n}\n","import { Board } from '../../../models/board';\nimport { Bishop } from '../../../models/pieces/bishop';\nimport { Color } from '../../../models/pieces/color';\nimport { King } from '../../../models/pieces/king';\nimport { Knight } from '../../../models/pieces/knight';\nimport { Pawn } from '../../../models/pieces/pawn';\nimport { Point } from '../../../models/pieces/point';\nimport { Queen } from '../../../models/pieces/queen';\nimport { Rook } from '../../../models/pieces/rook';\nimport { UnicodeConstants } from '../../../utils/unicode-constants';\nimport { AbstractEngineFacade } from '../../abstract-engine-facade';\nimport { DefaultPiecesLoader } from './default-pieces-loader';\nimport { NotationProcessor } from './notation-processors/notation-processor';\nimport { NotationProcessorFactory } from './notation-processors/notation-processor-factory';\n\nexport class BoardLoader {\n\n    private engineFacade: AbstractEngineFacade;\n    private notationProcessor: NotationProcessor;\n\n    constructor(engineFacade: AbstractEngineFacade, notationProcessor?: NotationProcessor) {\n        this.engineFacade = engineFacade;\n\n        if (notationProcessor) {\n            this.notationProcessor = notationProcessor;\n        } else {\n            this.notationProcessor = NotationProcessorFactory.getDefaultProcessor();\n        }\n\n    }\n\n    addPieces() {\n        DefaultPiecesLoader.loadDefaultPieces(this.engineFacade.board);\n    }\n\n    loadFEN(fen: string) {\n        this.notationProcessor.process(fen, this.engineFacade);\n    }\n\n    loadPGN(pgn: string) {\n        this.notationProcessor.process(pgn, this.engineFacade)\n    }\n\n    setEngineFacade(engineFacade: AbstractEngineFacade) {\n        this.engineFacade = engineFacade;\n    }\n\n    setNotationProcessor(notationProcessor: NotationProcessor) {\n        this.notationProcessor = notationProcessor;\n    }\n\n}\n","import { Board } from '../../../models/board';\n\nexport class BoardState {\n\n    board: Board;\n\n    constructor(board: Board) {\n        this.board = board;\n    }\n\n}\n","import { BehaviorSubject } from 'rxjs';\r\nimport { BoardState } from './board-state';\r\n\r\nexport class BoardStateProvider {\r\n    statesSubject$ = new BehaviorSubject<BoardState[]>([]);\r\n\r\n    get states(): BoardState[] {\r\n        return this.statesSubject$.value;\r\n    }\r\n\r\n    set states(states: BoardState[]) {\r\n        this.statesSubject$.next(states);\r\n    }\r\n\r\n    addMove(state: BoardState) {\r\n        this.states = [...this.states, state];\r\n    }\r\n\r\n    getStates(): BoardState[] {\r\n        return this.states;\r\n    }\r\n\r\n    pop(): BoardState {\r\n        const lastState = this.getLastState();\r\n        this.states = this.states.filter((state) => state !== lastState);\r\n        return lastState;\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.states.length === 0;\r\n    }\r\n\r\n    clear() {\r\n        this.states = [];\r\n    }\r\n\r\n    getLastState() {\r\n        return this.states[this.getLastStateIndex()];\r\n    }\r\n\r\n    getLastStateIndex(): number {\r\n        return this.states.length - 1;\r\n    }\r\n}\r\n","import { DrawPoint } from '../draw-point';\r\n\r\nexport class Arrow {\r\n    start: DrawPoint;\r\n    end: DrawPoint;\r\n\r\n    isEqual(arrow: Arrow) {\r\n        return arrow && this.start.isEqual(arrow.start) && this.end.isEqual(arrow.end);\r\n    }\r\n}\r\n","import { DrawPoint } from '../draw-point';\r\n\r\nexport class Circle {\r\n    drawPoint: DrawPoint;\r\n\r\n    isEqual(circle: Circle) {\r\n        return circle && this.drawPoint.isEqual(circle.drawPoint);\r\n    }\r\n}\r\n","import { Board } from '../../models/board';\r\nimport { Color } from '../../models/pieces/color';\r\nimport { Point } from '../../models/pieces/point';\r\nimport { MoveUtils } from '../../utils/move-utils';\r\nimport { AbstractPiece } from './abstract-piece';\r\nimport { PieceAbstractDecorator } from './piece-abstract-decorator';\r\n\r\nexport class AvailableMoveDecorator extends PieceAbstractDecorator {\r\n    private pointClicked: Point;\r\n    private color: Color;\r\n    private board: Board;\r\n\r\n    constructor(piece: AbstractPiece, pointClicked: Point, color: Color, board: Board) {\r\n        super(piece);\r\n        this.pointClicked = pointClicked;\r\n        this.color = color;\r\n        this.board = board;\r\n    }\r\n\r\n    getPossibleCaptures(): Point[] {\r\n        return this.piece\r\n            .getPossibleCaptures()\r\n            .filter(\r\n                (point) =>\r\n                    !MoveUtils.willMoveCauseCheck(\r\n                        this.color,\r\n                        this.pointClicked.row,\r\n                        this.pointClicked.col,\r\n                        point.row,\r\n                        point.col,\r\n                        this.board\r\n                    )\r\n            );\r\n    }\r\n\r\n    getPossibleMoves(): Point[] {\r\n        return this.piece\r\n            .getPossibleMoves()\r\n            .filter(\r\n                (point) =>\r\n                    !MoveUtils.willMoveCauseCheck(\r\n                        this.color,\r\n                        this.pointClicked.row,\r\n                        this.pointClicked.col,\r\n                        point.row,\r\n                        point.col,\r\n                        this.board\r\n                    )\r\n            );\r\n    }\r\n}\r\n","import { Point } from '../../models/pieces/point';\r\nimport { AbstractPiece } from './abstract-piece';\r\n\r\nexport abstract class PieceAbstractDecorator implements AbstractPiece {\r\n\r\n    piece: AbstractPiece;\r\n\r\n    protected constructor(piece: AbstractPiece) {\r\n        this.piece = piece;\r\n    }\r\n\r\n    abstract getPossibleCaptures(): Point[];\r\n\r\n    abstract getPossibleMoves(): Point[];\r\n\r\n}\r\n","import { Board } from '../models/board';\r\nimport { Bishop } from '../models/pieces/bishop';\r\nimport { Color } from '../models/pieces/color';\r\nimport { Knight } from '../models/pieces/knight';\r\nimport { Piece } from '../models/pieces/piece';\r\nimport { Queen } from '../models/pieces/queen';\r\nimport { Rook } from '../models/pieces/rook';\r\nimport { UnicodeConstants } from '../utils/unicode-constants';\r\n\r\nexport class PiecePromotionResolver {\r\n\r\n    static resolvePromotionChoice(board: Board, piece: Piece, index: number) {\r\n        const isWhite = piece.color === Color.WHITE;\r\n        switch (index) {\r\n            case 1:\r\n                board.pieces.push(\r\n                    new Queen(\r\n                        piece.point,\r\n                        piece.color,\r\n                        isWhite\r\n                            ? UnicodeConstants.WHITE_QUEEN\r\n                            : UnicodeConstants.BLACK_QUEEN,\r\n                        board\r\n                    )\r\n                );\r\n                break;\r\n            case 2:\r\n                board.pieces.push(\r\n                    new Rook(\r\n                        piece.point,\r\n                        piece.color,\r\n                        isWhite\r\n                            ? UnicodeConstants.WHITE_ROOK\r\n                            : UnicodeConstants.BLACK_ROOK,\r\n                        board\r\n                    )\r\n                );\r\n                break;\r\n            case 3:\r\n                board.pieces.push(\r\n                    new Bishop(\r\n                        piece.point,\r\n                        piece.color,\r\n                        isWhite\r\n                            ? UnicodeConstants.WHITE_BISHOP\r\n                            : UnicodeConstants.BLACK_BISHOP,\r\n                        board\r\n                    )\r\n                );\r\n                break;\r\n            case 4:\r\n                board.pieces.push(\r\n                    new Knight(\r\n                        piece.point,\r\n                        piece.color,\r\n                        isWhite\r\n                            ? UnicodeConstants.WHITE_KNIGHT\r\n                            : UnicodeConstants.BLACK_KNIGHT,\r\n                        board\r\n                    )\r\n                );\r\n                break;\r\n        }\r\n    }\r\n\r\n}\r\n","import { Board } from '../../models/board';\r\nimport { MoveTranslation } from '../../models/move-translation';\r\nimport { Bishop } from '../../models/pieces/bishop';\r\nimport { Color } from '../../models/pieces/color';\r\nimport { King } from '../../models/pieces/king';\r\nimport { Knight } from '../../models/pieces/knight';\r\nimport { Pawn } from '../../models/pieces/pawn';\r\nimport { Piece } from '../../models/pieces/piece';\r\nimport { Point } from '../../models/pieces/point';\r\nimport { Queen } from '../../models/pieces/queen';\r\nimport { Rook } from '../../models/pieces/rook';\r\nimport {\r\n    ColorInput,\r\n    PieceTypeInput\r\n} from '../../utils/inputs/piece-type-input';\r\nimport { UnicodeConstants } from '../../utils/unicode-constants';\r\n\r\nexport class PieceFactory {\r\n\r\n    static create(\r\n        indexes: MoveTranslation,\r\n        pieceTypeInput: PieceTypeInput,\r\n        colorInput: ColorInput,\r\n        board: Board\r\n    ): Piece {\r\n        let piece;\r\n        let color = colorInput === ColorInput.LIGHT\r\n            ? Color.WHITE\r\n            : Color.BLACK;\r\n\r\n        switch (pieceTypeInput) {\r\n            case PieceTypeInput.QUEEN:\r\n                piece = new Queen(\r\n                    new Point(indexes.yAxis, indexes.xAxis),\r\n                    color,\r\n                    color === Color.WHITE ? UnicodeConstants.WHITE_QUEEN : UnicodeConstants.BLACK_QUEEN,\r\n                    board\r\n                );\r\n                break;\r\n            case PieceTypeInput.KING:\r\n                piece = new King(\r\n                    new Point(indexes.yAxis, indexes.xAxis),\r\n                    color,\r\n                    color === Color.WHITE ? UnicodeConstants.WHITE_KING : UnicodeConstants.BLACK_KING,\r\n                    board\r\n                );\r\n\r\n                break;\r\n            case PieceTypeInput.KNIGHT:\r\n                piece = new Knight(\r\n                    new Point(indexes.yAxis, indexes.xAxis),\r\n                    color,\r\n                    color === Color.WHITE ? UnicodeConstants.WHITE_KNIGHT : UnicodeConstants.BLACK_KNIGHT,\r\n                    board\r\n                );\r\n                break;\r\n            case PieceTypeInput.BISHOP:\r\n                piece = new Bishop(\r\n                    new Point(indexes.yAxis, indexes.xAxis),\r\n                    color,\r\n                    color === Color.WHITE ? UnicodeConstants.WHITE_BISHOP : UnicodeConstants.BLACK_BISHOP,\r\n                    board\r\n                );\r\n                break;\r\n            case PieceTypeInput.ROOK:\r\n                piece = new Rook(\r\n                    new Point(indexes.yAxis, indexes.xAxis),\r\n                    color,\r\n                    color === Color.WHITE ? UnicodeConstants.WHITE_ROOK : UnicodeConstants.BLACK_ROOK,\r\n                    board\r\n                );\r\n                break;\r\n            case PieceTypeInput.PAWN:\r\n                piece = new Pawn(\r\n                    new Point(indexes.yAxis, indexes.xAxis),\r\n                    color,\r\n                    color === Color.WHITE ? UnicodeConstants.WHITE_PAWN : UnicodeConstants.BLACK_PAWN,\r\n                    board\r\n                );\r\n                break;\r\n        }\r\n\r\n        return piece;\r\n    }\r\n}\r\n","import { EventEmitter } from '@angular/core';\nimport { HistoryMove } from '../history-move-provider/history-move';\nimport { ColorInput, PieceTypeInput } from '../utils/inputs/piece-type-input';\nimport { AbstractEngineFacade } from './abstract-engine-facade';\n\nimport { BoardLoader } from './board-state-provider/board-loader/board-loader';\nimport { BoardState } from './board-state-provider/board-state/board-state';\nimport { BoardStateProvider } from './board-state-provider/board-state/board-state-provider';\nimport { MoveStateProvider } from './board-state-provider/board-state/move-state-provider';\nimport { ClickUtils } from './click/click-utils';\nimport { Arrow } from './drawing-tools/shapes/arrow';\nimport { Circle } from './drawing-tools/shapes/circle';\nimport { DrawPoint } from './drawing-tools/draw-point';\nimport { DrawProvider } from './drawing-tools/draw-provider';\nimport { Board } from '../models/board';\nimport { Color } from '../models/pieces/color';\nimport { King } from '../models/pieces/king';\nimport { Pawn } from '../models/pieces/pawn';\nimport { Piece } from '../models/pieces/piece';\nimport { Point } from '../models/pieces/point';\nimport { AvailableMoveDecorator } from './piece-decorator/available-move-decorator';\nimport { PiecePromotionResolver } from '../piece-promotion/piece-promotion-resolver';\nimport { MoveUtils } from '../utils/move-utils';\nimport { MoveChange } from './move-change/move-change';\nimport { PieceFactory } from './utils/piece-factory';\n\nexport class EngineFacade extends AbstractEngineFacade {\n\n    _selected = false;\n    drawPoint: DrawPoint;\n    drawProvider: DrawProvider;\n    disabling = false;\n    boardStateProvider: BoardStateProvider;\n    moveStateProvider: MoveStateProvider;\n    moveChange: EventEmitter<MoveChange>;\n\n    constructor(\n        board: Board,\n        moveChange: EventEmitter<MoveChange>\n    ) {\n        super(board);\n        this.moveChange = moveChange;\n        this.boardLoader = new BoardLoader(this);\n        this.boardLoader.addPieces();\n        this.boardStateProvider = new BoardStateProvider();\n    }\n\n    public reset(): void {\n        this.boardStateProvider.clear();\n        this.moveHistoryProvider.clear();\n        this.boardLoader.addPieces();\n        this.board.reset();\n        this.coords.reset();\n        this.drawProvider.clear();\n        this.freeMode = false;\n    }\n\n    public undo(): void {\n        if (!this.boardStateProvider.isEmpty()) {\n            const lastBoard = this.boardStateProvider.pop().board;\n            if (this.board.reverted) {\n                lastBoard.reverse();\n            }\n            this.board = lastBoard;\n            this.board.possibleCaptures = [];\n            this.board.possibleMoves = [];\n            this.moveHistoryProvider.pop();\n        }\n    }\n\n    saveMoveClone() {\n        const clone = this.board.clone();\n\n        if (this.board.reverted) {\n            clone.reverse();\n        }\n        this.moveStateProvider.addMove(new BoardState(clone));\n    }\n\n    public move(coords: string) {\n        if (coords) {\n            const sourceIndexes = MoveUtils.translateCoordsToIndex(\n                coords.substring(0, 2),\n                this.board.reverted\n            );\n\n            const destIndexes = MoveUtils.translateCoordsToIndex(\n                coords.substring(2, 4),\n                this.board.reverted\n            );\n\n            const srcPiece = this.board.getPieceByPoint(\n                sourceIndexes.yAxis,\n                sourceIndexes.xAxis\n            );\n\n            if (srcPiece) {\n                if (\n                    (this.board.currentWhitePlayer &&\n                        srcPiece.color === Color.BLACK) ||\n                    (!this.board.currentWhitePlayer &&\n                        srcPiece.color === Color.WHITE)\n                ) {\n                    return;\n                }\n\n                this.prepareActivePiece(srcPiece, srcPiece.point);\n\n                if (\n                    this.board.isPointInPossibleMoves(\n                        new Point(destIndexes.yAxis, destIndexes.xAxis)\n                    ) ||\n                    this.board.isPointInPossibleCaptures(\n                        new Point(destIndexes.yAxis, destIndexes.xAxis)\n                    )\n                ) {\n                    this.saveClone();\n                    this.movePiece(\n                        srcPiece,\n                        new Point(destIndexes.yAxis, destIndexes.xAxis),\n                        coords.length === 5 ? +coords.substring(4, 5) : 0\n                    );\n\n                    this.board.lastMoveSrc = new Point(\n                        sourceIndexes.yAxis,\n                        sourceIndexes.xAxis\n                    );\n                    this.board.lastMoveDest = new Point(\n                        destIndexes.yAxis,\n                        destIndexes.xAxis\n                    );\n\n                    this.disableSelection();\n                } else {\n                    this.disableSelection();\n                }\n            }\n        }\n\n    }\n\n    prepareActivePiece(pieceClicked: Piece, pointClicked: Point) {\n        this.board.activePiece = pieceClicked;\n        this._selected = true;\n        this.board.possibleCaptures = new AvailableMoveDecorator(\n            pieceClicked,\n            pointClicked,\n            this.board.currentWhitePlayer ? Color.WHITE : Color.BLACK,\n            this.board\n        ).getPossibleCaptures();\n        this.board.possibleMoves = new AvailableMoveDecorator(\n            pieceClicked,\n            pointClicked,\n            this.board.currentWhitePlayer ? Color.WHITE : Color.BLACK,\n            this.board\n        ).getPossibleMoves();\n    }\n\n    onPieceClicked(pieceClicked, pointClicked) {\n        if (\n            (this.board.currentWhitePlayer && pieceClicked.color === Color.BLACK) ||\n            (!this.board.currentWhitePlayer && pieceClicked.color === Color.WHITE)\n        ) {\n            return;\n        }\n\n        this.prepareActivePiece(pieceClicked, pointClicked);\n    }\n\n    public handleClickEvent(pointClicked: Point, isMouseDown: boolean) {\n        let moving = false;\n\n        if ((\n            this.board.isPointInPossibleMoves(pointClicked) ||\n            this.board.isPointInPossibleCaptures(pointClicked)\n        ) || this.freeMode) {\n            this.saveClone();\n            this.board.lastMoveSrc = new Point(\n                this.board.activePiece.point.row,\n                this.board.activePiece.point.col\n            );\n            this.board.lastMoveDest = pointClicked.clone();\n            this.movePiece(this.board.activePiece, pointClicked);\n\n            if (!this.board.activePiece.point.isEqual(this.board.lastMoveSrc)) {\n                moving = true;\n            }\n        }\n\n        if (isMouseDown || moving) {\n            this.disableSelection();\n        }\n        this.disableSelection();\n        const pieceClicked = this.board.getPieceByPoint(\n            pointClicked.row,\n            pointClicked.col\n        );\n        if (pieceClicked && !moving) {\n            this.onFreeMode(pieceClicked);\n            this.onPieceClicked(pieceClicked, pointClicked);\n        }\n    }\n\n    onMouseDown(\n        event: MouseEvent,\n        pointClicked: Point,\n        left?: number,\n        top?: number\n    ) {\n        if (event.button !== 0) {\n            this.drawPoint = ClickUtils.getDrawingPoint(\n                this.heightAndWidth,\n                this.colorStrategy,\n                event.x,\n                event.y,\n                event.ctrlKey,\n                event.altKey,\n                event.shiftKey,\n                left,\n                top\n            );\n            return;\n        }\n\n        this.drawProvider.clear();\n\n        if (\n            this.board.activePiece &&\n            pointClicked.isEqual(this.board.activePiece.point)\n        ) {\n            this.disabling = true;\n            return;\n        }\n\n        const pieceClicked = this.board.getPieceByPoint(\n            pointClicked.row,\n            pointClicked.col\n        );\n\n        if (this.freeMode) {\n            if (pieceClicked) {\n                if (event.ctrlKey) {\n                    this.board.pieces = this.board.pieces.filter(e => e !== pieceClicked);\n                    return;\n                }\n                this.board.currentWhitePlayer = (pieceClicked.color === Color.WHITE);\n            }\n        }\n\n        if (this.isPieceDisabled(pieceClicked)) {\n            return;\n        }\n\n        if (this._selected) {\n            this.handleClickEvent(pointClicked, true);\n        } else {\n            if (pieceClicked) {\n                this.onFreeMode(pieceClicked);\n                this.onPieceClicked(pieceClicked, pointClicked);\n            }\n        }\n    }\n\n    onMouseUp(\n        event: MouseEvent,\n        pointClicked: Point,\n        left: number,\n        top: number\n    ) {\n        if (event.button !== 0 && !this.drawDisabled) {\n            this.addDrawPoint(\n                event.x,\n                event.y,\n                event.ctrlKey,\n                event.altKey,\n                event.shiftKey,\n                left, top\n            );\n            return;\n        }\n\n        this.drawProvider.clear();\n\n        if (this.dragDisabled) {\n            return;\n        }\n\n        if (\n            this.board.activePiece &&\n            pointClicked.isEqual(this.board.activePiece.point) &&\n            this.disabling\n        ) {\n            this.disableSelection();\n            this.disabling = false;\n            return;\n        }\n        const pieceClicked = this.board.getPieceByPoint(\n            pointClicked.row,\n            pointClicked.col\n        );\n\n        if (this.isPieceDisabled(pieceClicked)) {\n            return;\n        }\n\n        if (this._selected) {\n            this.handleClickEvent(pointClicked, false);\n            //   this.possibleMoves = activePiece.getPossibleMoves();\n        }\n    }\n\n    saveClone() {\n        const clone = this.board.clone();\n\n        if (this.board.reverted) {\n            clone.reverse();\n        }\n        this.boardStateProvider.addMove(new BoardState(clone));\n    }\n\n    movePiece(toMovePiece: Piece, newPoint: Point, promotionIndex?: number) {\n        const destPiece = this.board.pieces.find(\n            (piece) =>\n                piece.point.col === newPoint.col &&\n                piece.point.row === newPoint.row\n        );\n\n        if (destPiece && toMovePiece.color !== destPiece.color) {\n            this.board.pieces = this.board.pieces.filter(\n                (piece) => piece !== destPiece\n            );\n        } else {\n            if (destPiece && toMovePiece.color === destPiece.color) {\n                return;\n            }\n        }\n\n        const move = new HistoryMove(\n            MoveUtils.format(toMovePiece.point, newPoint, this.board.reverted),\n            toMovePiece.constant.name,\n            toMovePiece.color === Color.WHITE ? 'white' : 'black',\n            !!destPiece\n        );\n        this.moveHistoryProvider.addMove(move);\n\n        if (toMovePiece instanceof King) {\n            const squaresMoved = Math.abs(newPoint.col - toMovePiece.point.col);\n            if (squaresMoved > 1) {\n                if (newPoint.col < 3) {\n                    const leftRook = this.board.getPieceByField(\n                        toMovePiece.point.row,\n                        0\n                    );\n                    if (!this.freeMode) {\n                        leftRook.point.col = this.board.reverted ? 2 : 3;\n                    }\n                } else {\n                    const rightRook = this.board.getPieceByField(\n                        toMovePiece.point.row,\n                        7\n                    );\n                    if (!this.freeMode) {\n                        rightRook.point.col = this.board.reverted ? 4 : 5;\n                    }\n                }\n            }\n        }\n\n        if (toMovePiece instanceof Pawn) {\n            this.board.checkIfPawnTakesEnPassant(newPoint);\n            this.board.checkIfPawnEnpassanted(toMovePiece, newPoint);\n        } else {\n            this.board.enPassantPoint = null;\n            this.board.enPassantPiece = null;\n        }\n\n        toMovePiece.point = newPoint;\n        this.increaseFullMoveCount();\n        this.board.currentWhitePlayer = !this.board.currentWhitePlayer;\n\n        if (!this.checkForPawnPromote(toMovePiece, promotionIndex)) {\n            this.afterMoveActions();\n        }\n    }\n\n    checkForPawnPromote(toPromotePiece: Piece, promotionIndex?: number) {\n        if (!(toPromotePiece instanceof Pawn)) {\n            return;\n        }\n\n        if (toPromotePiece.point.row === 0 || toPromotePiece.point.row === 7) {\n            this.board.pieces = this.board.pieces.filter(\n                (piece) => piece !== toPromotePiece\n            );\n\n            // When we make move manually, we pass promotion index already, so we don't need\n            // to acquire it from promote dialog\n            if (!promotionIndex) {\n                this.openPromoteDialog(toPromotePiece);\n            } else {\n                PiecePromotionResolver.resolvePromotionChoice(\n                    this.board,\n                    toPromotePiece,\n                    promotionIndex\n                );\n                this.afterMoveActions(promotionIndex);\n            }\n\n            return true;\n        }\n    }\n\n    afterMoveActions(promotionIndex?: number) {\n        this.checkIfPawnFirstMove(this.board.activePiece);\n        this.checkIfRookMoved(this.board.activePiece);\n        this.checkIfKingMoved(this.board.activePiece);\n\n        this.board.blackKingChecked = this.board.isKingInCheck(\n            Color.BLACK,\n            this.board.pieces\n        );\n        this.board.whiteKingChecked = this.board.isKingInCheck(\n            Color.WHITE,\n            this.board.pieces\n        );\n        const check =\n            this.board.blackKingChecked || this.board.whiteKingChecked;\n        const checkmate =\n            this.checkForPossibleMoves(Color.BLACK) ||\n            this.checkForPossibleMoves(Color.WHITE);\n        const stalemate =\n            this.checkForPat(Color.BLACK) || this.checkForPat(Color.WHITE);\n\n        this.disabling = false;\n        this.board.calculateFEN();\n\n        const lastMove = this.moveHistoryProvider.getLastMove();\n        if (lastMove && promotionIndex) {\n            lastMove.move += promotionIndex;\n        }\n\n        this.moveChange.emit({\n            ...lastMove,\n            check,\n            checkmate,\n            stalemate,\n            fen: this.board.fen,\n            freeMode: this.freeMode\n        });\n    }\n\n    checkForPat(color: Color) {\n        if (color === Color.WHITE && !this.board.whiteKingChecked) {\n            return this.checkForPossibleMoves(color);\n        } else {\n            if (color === Color.BLACK && !this.board.blackKingChecked) {\n                return this.checkForPossibleMoves(color);\n            }\n        }\n    }\n\n    openPromoteDialog(piece: Piece) {\n        this.modal.open((index) => {\n            PiecePromotionResolver.resolvePromotionChoice(\n                this.board,\n                piece,\n                index\n            );\n            this.afterMoveActions(index);\n        });\n    }\n\n    checkForPossibleMoves(color: Color): boolean {\n        return !this.board.pieces\n            .filter((piece) => piece.color === color)\n            .some(\n                (piece) =>\n                    piece\n                        .getPossibleMoves()\n                        .some(\n                            (move) =>\n                                !MoveUtils.willMoveCauseCheck(\n                                    color,\n                                    piece.point.row,\n                                    piece.point.col,\n                                    move.row,\n                                    move.col,\n                                    this.board\n                                )\n                        ) ||\n                    piece\n                        .getPossibleCaptures()\n                        .some(\n                            (capture) =>\n                                !MoveUtils.willMoveCauseCheck(\n                                    color,\n                                    piece.point.row,\n                                    piece.point.col,\n                                    capture.row,\n                                    capture.col,\n                                    this.board\n                                )\n                        )\n            );\n    }\n\n    disableSelection() {\n        this._selected = false;\n        this.board.possibleCaptures = [];\n        this.board.activePiece = null;\n        this.board.possibleMoves = [];\n    }\n\n    /**\n     * Processes logic to allow freeMode based logic processing\n     */\n    onFreeMode(pieceClicked) {\n        if (\n            !this.freeMode ||\n            pieceClicked === undefined ||\n            pieceClicked === null\n        ) {\n            return;\n        }\n        // sets player as white in-case white pieces are selected, and vice-versa when black is selected\n        this.board.currentWhitePlayer = pieceClicked.color === Color.WHITE;\n    }\n\n    isPieceDisabled(pieceClicked: Piece) {\n        if (pieceClicked && pieceClicked.point) {\n            const foundCapture = this.board.possibleCaptures.find(\n                (capture) =>\n                    capture.col === pieceClicked.point.col &&\n                    capture.row === pieceClicked.point.row\n            );\n\n            if (foundCapture) {\n                return false;\n            }\n        }\n        return (\n            pieceClicked &&\n            ((this.lightDisabled && pieceClicked.color === Color.WHITE) ||\n                (this.darkDisabled && pieceClicked.color === Color.BLACK))\n        );\n    }\n\n    addDrawPoint(\n        x: number,\n        y: number,\n        crtl: boolean,\n        alt: boolean,\n        shift: boolean,\n        left: number,\n        top: number\n    ) {\n        const upPoint = ClickUtils.getDrawingPoint(\n            this.heightAndWidth,\n            this.colorStrategy,\n            x,\n            y,\n            crtl,\n            alt,\n            shift,\n            left,\n            top\n        );\n\n        if (this.drawPoint.isEqual(upPoint)) {\n            const circle = new Circle();\n            circle.drawPoint = upPoint;\n            if (!this.drawProvider.containsCircle(circle)) {\n                this.drawProvider.addCircle(circle);\n            } else {\n                this.drawProvider.reomveCircle(circle);\n            }\n        } else {\n            const arrow = new Arrow();\n            arrow.start = this.drawPoint;\n            arrow.end = upPoint;\n\n            if (!this.drawProvider.containsArrow(arrow)) {\n                this.drawProvider.addArrow(arrow);\n            } else {\n                this.drawProvider.removeArrow(arrow);\n            }\n        }\n    }\n\n    increaseFullMoveCount() {\n        if (!this.board.currentWhitePlayer) {\n            ++this.board.fullMoveCount;\n        }\n    }\n\n    addPiece(\n        pieceTypeInput: PieceTypeInput,\n        colorInput: ColorInput,\n        coords: string\n    ) {\n        if (this.freeMode && coords && pieceTypeInput > 0 && colorInput > 0) {\n            let indexes = MoveUtils.translateCoordsToIndex(\n                coords,\n                this.board.reverted\n            );\n            let existing = this.board.getPieceByPoint(\n                indexes.yAxis,\n                indexes.xAxis\n            );\n            if (existing) {\n                this.board.pieces = this.board.pieces.filter(e => e !== existing);\n            }\n            let createdPiece = PieceFactory.create(\n                indexes,\n                pieceTypeInput,\n                colorInput,\n                this.board\n            );\n            this.saveClone();\n            this.board.pieces.push(createdPiece);\n            this.afterMoveActions();\n        }\n    }\n}\n","import { cloneDeep } from 'lodash';\nimport { Bishop } from './pieces/bishop';\nimport { Color } from './pieces/color';\nimport { King } from './pieces/king';\nimport { Knight } from './pieces/knight';\nimport { Pawn } from './pieces/pawn';\nimport { Piece } from './pieces/piece';\nimport { Point } from './pieces/point';\nimport { Queen } from './pieces/queen';\nimport { Rook } from './pieces/rook';\n\nexport class Board {\n    board: number[][] = [];\n    pieces: Piece[] = [];\n\n    enPassantPoint: Point = null;\n    enPassantPiece: Piece = null;\n    lastMoveSrc: Point = null;\n    lastMoveDest: Point = null;\n    activePiece: Piece;\n\n    blackKingChecked: boolean;\n    possibleCaptures: any[] = [];\n    possibleMoves: Point[] = [];\n    whiteKingChecked: boolean;\n\n    currentWhitePlayer = true;\n    reverted = false;\n    fullMoveCount = 1;\n    fen: string;\n\n    constructor() {\n        for (let i = 0; i < 8; ++i) {\n            this.board[i] = [];\n            for (let j = 0; j < 8; ++j) {\n                this.board[i][j] = 0;\n            }\n        }\n    }\n\n    isXYInPossibleMoves(row: number, col: number): boolean {\n        return this.possibleMoves.some((move) => move.row === row && move.col === col);\n    }\n\n    isXYInPossibleCaptures(row: number, col: number): boolean {\n        return this.possibleCaptures.some((capture) => capture.row === row && capture.col === col);\n    }\n\n    isXYInSourceMove(i: number, j: number) {\n        return this.lastMoveSrc && this.lastMoveSrc.row === i && this.lastMoveSrc.col === j;\n    }\n\n    isXYInDestMove(i: number, j: number) {\n        return this.lastMoveDest && this.lastMoveDest.row === i && this.lastMoveDest.col === j;\n    }\n\n    isXYInActiveMove(i: number, j: number) {\n        return this.activePiece && this.activePiece.point.row === i && this.activePiece.point.col === j;\n    }\n\n    isPointInPossibleMoves(point: Point): boolean {\n        return this.possibleMoves.some((move) => move.row === point.row && move.col === point.col);\n    }\n\n    isPointInPossibleCaptures(point: Point): boolean {\n        return this.possibleCaptures.some((capture) => capture.row === point.row && capture.col === point.col);\n    }\n\n    reset() {\n        this.lastMoveDest = null;\n        this.lastMoveSrc = null;\n        this.whiteKingChecked = false;\n        this.blackKingChecked = false;\n        this.possibleCaptures = [];\n        this.possibleMoves = [];\n        this.activePiece = null;\n        this.reverted = false;\n        this.currentWhitePlayer = true;\n        this.enPassantPoint = null;\n        this.enPassantPiece = null;\n        this.fullMoveCount = 1;\n        this.calculateFEN();\n    }\n\n        reverse() {\n        this.reverted = !this.reverted;\n        this.activePiece = null;\n        this.possibleMoves = [];\n        this.possibleCaptures = [];\n\n        this.pieces.forEach((piece: Piece) => this.reversePoint(piece.point));\n\n        this.reversePoint(this.lastMoveSrc);\n        this.reversePoint(this.lastMoveDest);\n\n        if (this.enPassantPoint && this.enPassantPiece) {\n            this.reversePoint(this.enPassantPoint);\n        }\n    }\n\n    clone(): Board {\n        return cloneDeep(this);\n    }\n\n    isFieldTakenByEnemy(row: number, col: number, enemyColor: Color): boolean {\n        if (row > 7 || row < 0 || col > 7 || col < 0) {\n            return false;\n        }\n        return this.pieces.some(\n            (piece) => piece.point.col === col && piece.point.row === row && piece.color === enemyColor\n        );\n    }\n\n    isFieldEmpty(row: number, col: number): boolean {\n        if (row > 7 || row < 0 || col > 7 || col < 0) {\n            return false;\n        }\n        return !this.pieces.some((piece) => piece.point.col === col && piece.point.row === row);\n    }\n\n    isFieldUnderAttack(row: number, col: number, color: Color) {\n        return this.pieces\n            .filter((piece) => piece.color === color)\n            .some((piece) => piece.getCoveredFields().some((field) => field.col === col && field.row === row));\n    }\n\n    getPieceByField(row: number, col: number): Piece {\n        if (this.isFieldEmpty(row, col)) {\n            //   throw new Error('Piece not found');\n            return undefined;\n        }\n\n        return this.pieces.find((piece) => piece.point.col === col && piece.point.row === row);\n    }\n\n    isKingInCheck(color: Color, pieces: Piece[]): boolean {\n        const king = pieces.find((piece) => piece.color === color && piece instanceof King);\n\n        if (king) {\n            return pieces.some(\n                (piece) =>\n                    piece\n                        .getPossibleCaptures()\n                        .some((point) => point.col === king.point.col && point.row === king.point.row) &&\n                    piece.color !== color\n            );\n        }\n        return false;\n    }\n\n    getKingByColor(color: Color): King {\n        return this.pieces.find((piece) => piece instanceof King && piece.color === color) as King;\n    }\n\n    getCastleFENString(color: Color) {\n        const king = this.getKingByColor(color);\n\n        if (!king || king.isMovedAlready) {\n            return '';\n        }\n\n        let fen = '';\n        const leftRook = this.getPieceByField(king.point.row, 0);\n        const rightRook = this.getPieceByField(king.point.row, 7);\n\n        if (rightRook instanceof Rook && rightRook.color === color) {\n            if (!rightRook.isMovedAlready) {\n                fen += this.reverted ? 'q' : 'k';\n            }\n        }\n\n        if (leftRook instanceof Rook && leftRook.color === color) {\n            if (!leftRook.isMovedAlready) {\n                fen += this.reverted ? 'k' : 'q';\n            }\n        }\n\n        fen = fen.split('').sort().join('');\n        return color === Color.BLACK ? fen : fen.toUpperCase();\n    }\n\n    getEnPassantFENString() {\n        if (this.enPassantPoint) {\n            if (this.reverted) {\n                return String.fromCharCode(104 - this.enPassantPoint.col) + (this.enPassantPoint.row + 1);\n            } else {\n                return String.fromCharCode(97 + this.enPassantPoint.col) + (Math.abs(this.enPassantPoint.row - 7) + 1);\n            }\n        } else {\n            return '-';\n        }\n    }\n\n    calculateFEN() {\n        let fen = '';\n        for (let i = 0; i < 8; ++i) {\n            let emptyFields = 0;\n            for (let j = 0; j < 8; ++j) {\n                const foundPiece = this.pieces.find((piece) => piece.point.col === j && piece.point.row === i);\n                if (foundPiece) {\n                    if (emptyFields > 0) {\n                        fen += emptyFields;\n                        emptyFields = 0;\n                    }\n\n                    if (foundPiece instanceof Rook) {\n                        fen += foundPiece.color === Color.BLACK ? 'r' : 'R';\n                    } else {\n                        if (foundPiece instanceof Knight) {\n                            fen += foundPiece.color === Color.BLACK ? 'n' : 'N';\n                        } else {\n                            if (foundPiece instanceof Bishop) {\n                                fen += foundPiece.color === Color.BLACK ? 'b' : 'B';\n                            } else {\n                                if (foundPiece instanceof Queen) {\n                                    fen += foundPiece.color === Color.BLACK ? 'q' : 'Q';\n                                } else {\n                                    if (foundPiece instanceof King) {\n                                        fen += foundPiece.color === Color.BLACK ? 'k' : 'K';\n                                    } else {\n                                        if (foundPiece instanceof Pawn) {\n                                            fen += foundPiece.color === Color.BLACK ? 'p' : 'P';\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                } else {\n                    ++emptyFields;\n                }\n            }\n\n            if (emptyFields > 0) {\n                fen += emptyFields;\n            }\n\n            fen += '/';\n        }\n\n        fen = fen.substr(0, fen.length - 1);\n\n        if (this.reverted) {\n            fen = fen.split('').reverse().join('');\n        }\n\n        fen += ' ' + (this.currentWhitePlayer ? 'w' : 'b');\n        const whiteEnPassant = this.getCastleFENString(Color.WHITE);\n        const blackEnPassant = this.getCastleFENString(Color.BLACK);\n        let concatedEnPassant = whiteEnPassant + blackEnPassant;\n        if (!concatedEnPassant) {\n            concatedEnPassant = '-';\n        }\n\n        fen += ' ' + concatedEnPassant;\n        fen += ' ' + this.getEnPassantFENString();\n        fen += ' ' + 0;\n        fen += ' ' + this.fullMoveCount;\n        this.fen = fen;\n    }\n\n    isXYInPointSelection(i: number, j: number) {\n        return false;\n    }\n\n    private reversePoint(point: Point) {\n        if (point) {\n            point.row = Math.abs(point.row - 7);\n            point.col = Math.abs(point.col - 7);\n        }\n    }\n\n    public getPieceByPoint(row: number, col: number): Piece {\n        row = Math.floor(row);\n        col = Math.floor(col);\n        return this.pieces.find(\n            (piece) => piece.point.col === col && piece.point.row === row\n        );\n    }\n\n    public checkIfPawnTakesEnPassant(newPoint: Point) {\n        if (newPoint.isEqual(this.enPassantPoint)) {\n            console.log('usuwam');\n            this.pieces = this.pieces.filter(\n                (piece) => piece !== this.enPassantPiece\n            );\n            this.enPassantPoint = null;\n            this.enPassantPiece = null;\n        }\n    }\n\n    public checkIfPawnEnpassanted(piece: Pawn, newPoint: Point) {\n        if (Math.abs(piece.point.row - newPoint.row) > 1) {\n            this.enPassantPiece = piece;\n            this.enPassantPoint = new Point(\n                (piece.point.row + newPoint.row) / 2,\n                piece.point.col\n            );\n        } else {\n            this.enPassantPoint = null;\n            this.enPassantPiece = null;\n        }\n    }\n\n    isKingChecked(piece: Piece) {\n        if (piece instanceof King) {\n            return piece.color === Color.WHITE\n                ? this.whiteKingChecked\n                : this.blackKingChecked;\n        }\n    }\n\n}\n","import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class NgxChessBoardService {\r\n    private componentMethodCallSource = new Subject<any>();\r\n\r\n    componentMethodCalled$ = this.componentMethodCallSource.asObservable();\r\n\r\n    reset() {\r\n        this.componentMethodCallSource.next();\r\n    }\r\n}\r\n","import { CdkDragEnd, CdkDragStart } from '@angular/cdk/drag-drop';\nimport {\n    AfterViewInit,\n    Component,\n    ElementRef,\n    EventEmitter,\n    HostListener,\n    Input,\n    OnChanges,\n    OnInit,\n    Output,\n    SimpleChanges,\n    ViewChild,\n} from '@angular/core';\nimport { AbstractEngineFacade } from './engine/abstract-engine-facade';\nimport { BoardLoader } from './engine/board-state-provider/board-loader/board-loader';\nimport {\n    NotationProcessorFactory, NotationType,\n} from './engine/board-state-provider/board-loader/notation-processors/notation-processor-factory';\nimport { ClickUtils } from './engine/click/click-utils';\nimport { EngineFacade } from './engine/engine-facade';\nimport { MoveChange } from './engine/move-change/move-change';\nimport { HistoryMove } from './history-move-provider/history-move';\nimport { Board } from './models/board';\nimport { Piece } from './models/pieces/piece';\nimport { NgxChessBoardView } from './ngx-chess-board-view';\nimport { PiecePromotionModalComponent } from './piece-promotion/piece-promotion-modal/piece-promotion-modal.component';\nimport { NgxChessBoardService } from './service/ngx-chess-board.service';\nimport { Constants } from './utils/constants';\nimport { PieceIconInput } from './utils/inputs/piece-icon-input';\nimport { PieceIconInputManager } from './utils/inputs/piece-icon-input-manager';\nimport { ColorInput, PieceTypeInput } from './utils/inputs/piece-type-input';\n\n\n@Component({\n    selector: 'ngx-chess-board',\n    templateUrl: './ngx-chess-board.component.html',\n    styleUrls: ['./ngx-chess-board.component.scss'],\n})\nexport class NgxChessBoardComponent\n    implements OnInit, OnChanges, NgxChessBoardView, AfterViewInit {\n\n    @Input() darkTileColor = Constants.DEFAULT_DARK_TILE_COLOR;\n    @Input() lightTileColor: string = Constants.DEFAULT_LIGHT_TILE_COLOR;\n    @Input() showCoords = true;\n    /**\n     * Enabling free mode removes turn-based restriction and allows to move any piece freely!\n     */\n    @Output() moveChange = new EventEmitter<MoveChange>();\n    @Output() checkmate = new EventEmitter<void>();\n    @Output() stalemate = new EventEmitter<void>();\n\n    @ViewChild('boardRef')\n    boardRef: ElementRef;\n    @ViewChild('modal')\n    modal: PiecePromotionModalComponent;\n\n    pieceSize: number;\n    selected = false;\n    boardLoader: BoardLoader;\n    pieceIconManager: PieceIconInputManager;\n\n    engineFacade: AbstractEngineFacade;\n\n    constructor(private ngxChessBoardService: NgxChessBoardService) {\n        this.engineFacade = new EngineFacade(\n            new Board(),\n            this.moveChange\n        );\n    }\n\n    @Input('size')\n    public set size(size: number) {\n        if (\n            size &&\n            size >= Constants.MIN_BOARD_SIZE &&\n            size <= Constants.MAX_BOARD_SIZE\n        ) {\n            this.engineFacade.heightAndWidth = size;\n        } else {\n            this.engineFacade.heightAndWidth = Constants.DEFAULT_SIZE;\n        }\n        this.engineFacade.drawProvider.clear();\n        this.calculatePieceSize();\n    }\n\n    @Input('freeMode')\n    public set freeMode(freeMode: boolean) {\n        this.engineFacade.freeMode = freeMode;\n    }\n\n    @Input('dragDisabled')\n    public set dragDisabled(dragDisabled: boolean) {\n        this.engineFacade.dragDisabled = dragDisabled;\n    }\n\n    @Input('drawDisabled')\n    public set drawDisabled(drawDisabled: boolean) {\n        this.engineFacade.drawDisabled = drawDisabled;\n    }\n\n    @Input('pieceIcons')\n    public set pieceIcons(pieceIcons: PieceIconInput) {\n        this.pieceIconManager.pieceIconInput = pieceIcons;\n    }\n\n    @Input('lightDisabled')\n    public set lightDisabled(lightDisabled: boolean) {\n        this.engineFacade.lightDisabled = lightDisabled;\n    }\n\n    @Input('darkDisabled')\n    public set darkDisabled(darkDisabled: boolean) {\n        this.engineFacade.darkDisabled = darkDisabled;\n    }\n\n    @HostListener('contextmenu', ['$event'])\n    onRightClick(event: MouseEvent) {\n        event.preventDefault();\n    }\n\n    ngOnChanges(changes: SimpleChanges) {\n        if (\n            (changes.lightDisabled &&\n                this.lightDisabled &&\n                this.engineFacade.board.currentWhitePlayer) ||\n            (changes.darkDisabled &&\n                this.darkDisabled &&\n                !this.engineFacade.board.currentWhitePlayer)\n        ) {\n            this.engineFacade.board.possibleCaptures = [];\n            this.engineFacade.board.possibleMoves = [];\n        }\n    }\n\n    ngOnInit() {\n        this.ngxChessBoardService.componentMethodCalled$.subscribe(() => {\n            this.engineFacade.reset();\n        });\n\n    }\n\n    ngAfterViewInit(): void {\n        this.engineFacade.modal = this.modal;\n        this.calculatePieceSize();\n    }\n\n    onMouseUp(event: MouseEvent) {\n        this.engineFacade.onMouseUp(\n            event,\n            this.getClickPoint(event),\n            this.boardRef.nativeElement.getBoundingClientRect().left,\n            this.boardRef.nativeElement.getBoundingClientRect().top\n        );\n    }\n\n    reverse(): void {\n        this.selected = false;\n        this.engineFacade.board.reverse();\n        this.engineFacade.coords.reverse();\n    }\n\n    updateBoard(board: Board) {\n        this.engineFacade.board = board;\n        this.boardLoader.setEngineFacade(this.engineFacade);\n        this.engineFacade.board.possibleCaptures = [];\n        this.engineFacade.board.possibleMoves = [];\n    }\n\n    setFEN(fen: string): void {\n        try {\n            this.engineFacade.boardLoader.setNotationProcessor(\n                NotationProcessorFactory.getProcessor(NotationType.FEN)\n            );\n            this.engineFacade.boardLoader.loadFEN(fen);\n            this.engineFacade.board.possibleCaptures = [];\n            this.engineFacade.board.possibleMoves = [];\n            this.engineFacade.coords.reset();\n        } catch (exception) {\n            this.engineFacade.boardLoader.addPieces();\n        }\n    }\n\n    setPGN(pgn: string): void {\n        try {\n            this.engineFacade.boardLoader.setNotationProcessor(\n                NotationProcessorFactory.getProcessor(NotationType.PGN)\n            );\n            this.engineFacade.boardLoader.loadPGN(pgn);\n            this.engineFacade.board.possibleCaptures = [];\n            this.engineFacade.board.possibleMoves = [];\n            this.engineFacade.coords.reset();\n        } catch (exception) {\n            console.log(exception);\n            this.engineFacade.boardLoader.addPieces();\n        }\n    }\n\n    getFEN(): string {\n        return this.engineFacade.board.fen;\n    }\n\n    dragEnded(event: CdkDragEnd): void {\n        this.engineFacade.dragEndStrategy.process(event);\n    }\n\n    dragStart(event: CdkDragStart): void {\n        this.engineFacade.dragStartStrategy.process(event);\n    }\n\n    onMouseDown(event: MouseEvent) {\n        this.engineFacade.onMouseDown(event, this.getClickPoint(event),\n            this.boardRef.nativeElement.getBoundingClientRect().left,\n            this.boardRef.nativeElement.getBoundingClientRect().top\n        );\n    }\n\n    getClickPoint(event) {\n        return ClickUtils.getClickPoint(\n            event,\n            this.boardRef.nativeElement.getBoundingClientRect().top,\n            this.boardRef.nativeElement.getBoundingClientRect().height,\n            this.boardRef.nativeElement.getBoundingClientRect().left,\n            this.boardRef.nativeElement.getBoundingClientRect().width\n        );\n    }\n\n    private calculatePieceSize() {\n        this.pieceSize = this.engineFacade.heightAndWidth / 10;\n    }\n\n\n    getCustomPieceIcons(piece: Piece) {\n        return JSON.parse(\n            `{ \"background-image\": \"url('${this.engineFacade.pieceIconManager.getPieceIcon(\n                piece\n            )}')\"}`\n        );\n    }\n\n    move(coords: string): void {\n        this.engineFacade.move(coords);\n    }\n\n    getMoveHistory(): HistoryMove[] {\n        return this.engineFacade.getMoveHistory();\n    }\n\n    reset(): void {\n        this.engineFacade.reset();\n    }\n\n    undo(): void {\n        this.engineFacade.undo();\n    }\n\n    addPiece(\n        pieceTypeInput: PieceTypeInput,\n        colorInput: ColorInput,\n        coords: string\n    ) {\n        this.engineFacade.addPiece(pieceTypeInput, colorInput, coords);\n    }\n\n}\n","import {Component, ElementRef, OnInit, ViewChild} from '@angular/core';\r\nimport {Piece} from '../../models/pieces/piece';\r\nimport {Observable} from 'rxjs';\r\n\r\n@Component({\r\n    selector: 'app-piece-promotion-modal',\r\n    templateUrl: './piece-promotion-modal.component.html',\r\n    styleUrls: ['./piece-promotion-modal.component.scss']\r\n})\r\nexport class PiecePromotionModalComponent {\r\n\r\n    @ViewChild('myModal', {static: false}) modal: ElementRef;\r\n\r\n    opened = false;\r\n    private onCloseCallback: (index: number) => void;\r\n\r\n    open(closeCallback: (index: number) => void) {\r\n        this.opened = true;\r\n        this.onCloseCallback = closeCallback;\r\n        this.modal.nativeElement.style.display = 'block';\r\n    }\r\n\r\n    changeSelection(index: number){\r\n        this.modal.nativeElement.style.display = 'none';\r\n        this.opened = false;\r\n        this.onCloseCallback(index);\r\n    }\r\n\r\n}\r\n","import { DragDropModule } from '@angular/cdk/drag-drop';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { NgxChessBoardComponent } from './ngx-chess-board.component';\r\nimport { PiecePromotionModalComponent } from './piece-promotion/piece-promotion-modal/piece-promotion-modal.component';\r\nimport { NgxChessBoardService } from './service/ngx-chess-board.service';\r\n\r\n@NgModule({\r\n    declarations: [NgxChessBoardComponent, PiecePromotionModalComponent],\r\n    imports: [CommonModule, DragDropModule],\r\n    exports: [NgxChessBoardComponent],\r\n})\r\nexport class NgxChessBoardModule {\r\n    static forRoot(): ModuleWithProviders<NgxChessBoardModule> {\r\n        return {\r\n            ngModule: NgxChessBoardModule,\r\n            providers: [NgxChessBoardService],\r\n        };\r\n    }\r\n}\r\n"]}